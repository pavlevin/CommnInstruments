/**
 *
 * Copyrights
 *
 * Portions created or assigned to Cisco Systems, Inc. are
 * Copyright (c) 2010 Cisco Systems, Inc.  All Rights Reserved.
 */
/*build/dist/CAXL-release-2014.04.10787/src/webinit.js*/
;(function(){var jabberwerx={};jabberwerx.system={jQuery_NoConflict:function(){var jq=jQuery.noConflict(true);if(typeof(window.jQuery)=="undefined"){window.jQuery=jq;}
if(typeof(window.$)=="undefined"){window.$=jq;}
return jq;},serializeXMLToString:function(node)
{if(node&&(typeof(XMLSerializer)!="undefined")){return new XMLSerializer().serializeToString(node)}
return null;},setTimeout:function(func,delay){return window.setTimeout(func,delay);},clearTimeout:function(timeoutID){window.clearTimeout(timeoutID);},setInterval:function(func,delay){return window.setInterval(func,delay);},clearInterval:function(intervalID){window.clearInterval(intervalID);},getConsole:function(){return window.console||null;},getLocale:function(){return navigator.userLanguage||navigator.language;}};jabberwerx.system.createXMLDocument=(function(){var fn=function(){fn=function(){return Windows.Data.Xml.Dom.XmlDocument();};try{return fn();}catch(ex){fn=function(){var doc=new ActiveXObject("Msxml2.DOMDocument.3.0");doc.async=false;return doc;}
try{return fn();}catch(ex){fn=function(){return document.implementation.createDocument(null,null,null);}
try{return fn();}catch(ex){fn=function(){throw new Error("No document constructor available.");}
return fn();}}}}
return function(){try{return fn();}catch(ex){console.log("Could not create XML Document: "+ex.message);throw ex;}}})();jabberwerx.system.parseXMLFromString=function(xmlstr){var dom=null;try{dom=jabberwerx.system.createXMLDocument();dom.loadXML(xmlstr);}catch(ex){try{dom=(new DOMParser()).parseFromString(xmlstr,"text/xml");}catch(ex){dom=null;}}
dom=dom?dom.documentElement:null;if(!dom||(dom.nodeName=="parsererror")||(jabberwerx.$("parsererror",dom).length>0))
{throw new TypeError("Parse error in trying to parse"+xmlstr);}
return dom;};if(typeof(Node)!="undefined"&&Node.prototype&&typeof(Object.defineProperty)!="undefined")
{Object.defineProperty(Node.prototype,"xml",{get:function(){return jabberwerx.system.serializeXMLToString(this);},enumerable:true,writeable:false,configurable:false});}
jabberwerx.system.getLocation=function(){return(document&&document.location)||{};};window.jabberwerx=jabberwerx;})();
/*build/dist/CAXL-release-2014.04.10787/src/jabberwerx.js*/
;(function(jabberwerx){var jq=jabberwerx.system.jQuery_NoConflict();jabberwerx.$=jq;jabberwerx=jq.extend(jabberwerx,{version:'2014.04.0',_config:{persistDuration:30,unsecureAllowed:false,capabilityFeatures:[],httpBindingURL:"/httpbinding",baseReconnectCountdown:30,enabledMechanisms:["DIGEST-MD5","PLAIN"]},_getInstallURL:function(){return this._getInstallPath();},_getInstallPath:function(){var p=this._config.installPath;if(!p){var target=String(arguments[0]||"jabberwerx")+".js";p=jabberwerx.$("script[src$='"+target+"']").slice(0,1).attr("src");p=p.substring(0,p.indexOf(target));}
return p.charAt(p.length-1)=='/'?p:p+'/';},parseTimestamp:function(timestamp){var result=/^([0-9]{4})(?:-?)([0-9]{2})(?:-?)([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2}(?:\.([0-9]+))?)(?:(Z|[-+]?[0-9]{2}:[0-9]{2})?)$/.exec(timestamp);if(!result){throw new TypeError("timestamp string not recognized");}
var ts,offset=0;ts=Date.UTC(Number(result[1]),Number(result[2])-1,Number(result[3]),Number(result[4]),Number(result[5]),Number(result[6]),0);if(result[8]&&result[8]!="Z"){result=/^([-+]?[0-9]{2}):([0-9]{2})$/.exec(result[8]);if(result){offset+=Number(result[1])*3600000;offset+=Number(result[2])*60000;}}
return new Date(ts-offset);},generateTimestamp:function(ts,legacy){var padFN=function(val,amt){var result="";if(amt>1){result=arguments.callee(parseInt(val/10),amt-1);}
return result+String(parseInt(val%10));};if(!(ts&&ts instanceof Date)){throw new TypeError("Expected Date object");}
var date=[padFN(ts.getUTCFullYear(),4),padFN(ts.getUTCMonth()+1,2),padFN(ts.getUTCDate(),2)];var time=[padFN(ts.getUTCHours(),2),padFN(ts.getUTCMinutes(),2),padFN(ts.getUTCSeconds(),2)];if(legacy){return date.join("")+"T"+time.join(":");}else{return date.join("-")+"T"+time.join(":")+"Z";}},_init:function(){this._inited=true;if(typeof jabberwerx_config!='undefined'){for(var name in jabberwerx_config){var val=jabberwerx_config[name];if(jabberwerx.$.isArray(val)&&val.concat){val=val.concat();}
this._config[name]=val;}}},reset:function(){if(this.client){this.client.disconnect();}},reduce:function(obj,fn,value){if(!jabberwerx.$.isFunction(fn)){throw new TypeError("expected function object");}
jabberwerx.$.each(obj,function(idx,item){value=fn(item,value);return true;});return value;},unique:function(arr){if(!jabberwerx.$.isArray(arr)){return arr;}
var specified={};for(var idx=arr.length-1;idx>=0;idx--){var item=arr[idx];if(!specified[item]){specified[item]=true;}else{arr.splice(idx,1);}}
return arr;},isText:function(o){return(o&&o.ownerDocument&&o.nodeType==3&&typeof o.nodeName=="string");},isElement:function(o){return(o&&(o.ownerDocument!==undefined)&&(o.nodeType==1)&&(typeof o.nodeName=="string"));},isDocument:function(o){return(o&&(o.documentElement!==undefined)&&(o.nodeType==9)&&(typeof o.nodeName=="string"));},client:null,_inited:false});jabberwerx._config.debug={on:true};jabberwerx.NodeBuilder=function(data){var parent,doc,ns=null;if(data instanceof jabberwerx.NodeBuilder){this.parent=parent=arguments[0];data=arguments[1];doc=parent.document;ns=parent.namespaceURI;}
if(jabberwerx.isDocument(data)){doc=data;data=doc.documentElement;ns=data.namespaceURI||data.getAttribute("xmlns")||ns;}else if(jabberwerx.isElement(data)){if(!doc){doc=data.ownerDocument;}else if(data.ownerDocument!==doc){data=(doc.importNode)?doc.importNode(data,true):data.cloneNode(true);}
if(parent&&parent.data){parent.data.appendChild(data);}
if(!doc.documentElement){doc.appendChild(data);}
ns=data.namespaceURI||data.getAttribute("xmlns")||ns;}else if(data){if(!doc){doc=this._createDoc();}
var ename,ln,pre;ename=this._parseName(data,ns);ns=ename.namespaceURI;data=this._createElem(doc,ns,ename.localName,ename.prefix);}else if(!parent){doc=this._createDoc();}
this.document=doc;this.data=data;this.namespaceURI=ns;};jabberwerx.NodeBuilder.prototype={attribute:function(name,val){var ename=this._parseName(name);if(ename.prefix&&ename.prefix!="xml"&&ename.prefix!="xmlns"){var xmlns="xmlns:"+ename.prefix;if(!this.data.getAttribute(xmlns)){this.attribute(xmlns,ename.namespaceURI||"");}}else if(ename.prefix=="xml"){ename.namespaceURI="http://www.w3.org/XML/1998/namespace";}else if(ename.prefix=="xmlns"||ename.localName=="xmlns"){ename.namespaceURI="http://www.w3.org/2000/xmlns/";}else if(!ename.prefix&&ename.namespaceURI!==null){throw new TypeError("namespaced attributes not supported");}
var doc=this.document;var elem=this.data;if(typeof(doc.createNode)!="undefined"){var attr=doc.createNode(2,ename.qualifiedName,ename.namespaceURI||"");attr.value=val||"";elem.setAttributeNode(attr);}else if(typeof(elem.setAttributeNS)!="undefined"){elem.setAttributeNS(ename.namespaceURI||"",ename.qualifiedName,val||"");}else{throw new TypeError("unsupported platform");}
return this;},text:function(val){if(!val){return this;}
var txt=this.document.createTextNode(val);this.data.appendChild(txt);return this;},element:function(name,attrs){if(!attrs){attrs={};}
if(typeof(name)!="string"){throw new TypeError("name is not a valid expanded name");}
var builder=new jabberwerx.NodeBuilder(this,name);for(var key in attrs){if(key=='xmlns'){continue;}
builder.attribute(key,attrs[key]);}
return builder;},node:function(n){if(!n){throw new TypeError("node must exist");}
if(jabberwerx.isDocument(n)){n=n.documentElement;}
if(jabberwerx.isElement(n)){return new jabberwerx.NodeBuilder(this,n);}else if(jabberwerx.isText(n)){return this.text(n.nodeValue);}else{throw new TypeError("Node must be an XML node");}
return this;},xml:function(val){var wrapper=(this.namespaceURI)?"<wrapper xmlns='"+this.namespaceURI+"'>":"<wrapper>";wrapper+=val+"</wrapper>";var parsed=this._parseXML(wrapper);var that=this;jabberwerx.$(parsed).contents().each(function(){if(jabberwerx.isElement(this)){new jabberwerx.NodeBuilder(that,this);}else if(jabberwerx.isText(this)){that.text(this.nodeValue);}});return this;},_parseName:function(name,ns){var ptn=/^(?:\{(.*)\})?(?:([^\s{}:]+):)?([^\s{}:]+)$/;var m=name.match(ptn);if(!m){throw new TypeError("name '"+name+"' is not a valid ename");}
var retval={namespaceURI:m[1],localName:m[3],prefix:m[2]};if(!retval.localName){throw new TypeError("local-name not value");}
retval.qualifiedName=(retval.prefix)?retval.prefix+":"+retval.localName:retval.localName;if(!retval.namespaceURI){if(name.indexOf("{}")==0){retval.namespaceURI="";}else{retval.namespaceURI=ns||null;}}
return retval;},_createDoc:jabberwerx.system.createXMLDocument,_parseXML:jabberwerx.system.parseXMLFromString,_createElem:function(doc,ns,ln,pre){var parent=this.parent;var elem;var qn=pre?(pre+":"+ln):ln;var declare=true;if(parent&&parent.data){if(parent.namespaceURI==ns||ns==null||ns==undefined){declare=false;}}else{declare=(ns!=null&&ns!=undefined);}
if(typeof(doc.createNode)!="undefined"){elem=doc.createNode(1,qn,ns||"");if(declare){var decl=doc.createNode(2,(pre?"xmlns:"+pre:"xmlns"),"http://www.w3.org/2000/xmlns/");decl.value=ns||"";elem.setAttributeNode(decl);}}else if(typeof(doc.createElementNS)!="undefined"){elem=doc.createElementNS(ns||"",qn);if(declare){elem.setAttributeNS("http://www.w3.org/2000/xmlns/",(pre?"xmlns:"+pre:"xmlns"),ns||"");}}else{throw Error("unsupported platform");}
if(!doc.documentElement){doc.appendChild(elem);}else if(parent&&parent.data){parent.data.appendChild(elem);}
return elem;}};jabberwerx.xhtmlim={};jabberwerx.xhtmlim.allowedStyles=["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"];jabberwerx.xhtmlim.allowedTags={br:[],em:[],strong:[],a:["style","href","type"],blockquote:["style"],cite:["style"],img:["style","alt","height","src","width"],li:["style"],ol:["style"],p:["style"],span:["style"],ul:["style"],body:["style","xmlns","xml:lang"]}
jabberwerx.xhtmlim.sanitize=function(xhtmlNode){var filterNodes=function(fNode){var myKids=fNode.children();var fDOM=fNode.get(0);if(jabberwerx.xhtmlim.allowedTags[fDOM.nodeName]===undefined){fNode.replaceWith(fDOM.childNodes);fNode.remove();}else{var i=0;while(i<fDOM.attributes.length){var aName=fDOM.attributes[i].nodeName;if(jabberwerx.$.inArray(aName,jabberwerx.xhtmlim.allowedTags[fDOM.nodeName])==-1){fNode.removeAttr(aName);}else{if(aName=="href"||aName=="src"){var aValue=fDOM.attributes[i].nodeValue;if(aValue.indexOf("javascript:")==0){fNode.replaceWith(fDOM.childNodes);fNode.remove();}}else if(aName=="style"){var rProps=jabberwerx.$.map(fDOM.attributes[i].value.split(';'),function(oneStyle,idx){return jabberwerx.$.inArray(oneStyle.split(':')[0],jabberwerx.xhtmlim.allowedStyles)!=-1?oneStyle:null;});fNode.attr("style",rProps.join(';'));}
++i;}}}
for(var i=0;i<myKids.length;++i){if(jabberwerx.isElement(myKids[i])){filterNodes(jabberwerx.$(myKids[i]));}}}
if(!jabberwerx.isElement(xhtmlNode)){throw new TypeError("xhtmlNode must be a DOM");}
if(jabberwerx.xhtmlim.allowedTags[xhtmlNode.nodeName]===undefined){throw new TypeError("xhtmlNode must be an allowed tag")}
filterNodes(jabberwerx.$(xhtmlNode));return xhtmlNode;}
jabberwerx._init();})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/jwapp/JWCore.js*/
;(function(jabberwerx){jabberwerx.util={};var initializing=false;jabberwerx.JWBase=function(){};jabberwerx.JWBase.prototype.init=function(){};jabberwerx.JWBase.prototype.destroy=function(){return null;};jabberwerx.JWBase.prototype.getClassName=function(){return this._className||'';};jabberwerx.JWBase.prototype.toString=function(){return'['+this.getClassName()+']';};jabberwerx.JWBase.prototype.shouldBeSavedWithGraph=function(){return false;};jabberwerx.JWBase.prototype.shouldBeSerializedInline=function(){return false;};jabberwerx.JWBase.prototype.willBeSerialized=function(){};jabberwerx.JWBase.prototype.wasUnserialized=function(){jabberwerx.$.each(this._observerInfo,function(eventName,info){info.observers=jabberwerx.$.grep(info.observers,function(observer,i){return typeof observer.target!='undefined';});});};jabberwerx.JWBase.prototype.graphUnserialized=function(){}
jabberwerx.JWBase.prototype.invocation=function(methodName,boundArguments){return jabberwerx.util.generateInvocation(this,methodName,boundArguments);};var __jwa__createOverrideChain=function(base,override){if(base!==undefined&&override===undefined){return base;}
if(!jabberwerx.$.isFunction(base)||!jabberwerx.$.isFunction(override)){return override;}
return function(){var tmp=this._super;this._super=base;var retval=override.apply(this,arguments);this._super=tmp;return retval;};};jabberwerx.JWBase.mixin=function(prop){prop=jabberwerx.$.extend(true,{},prop);for(var name in prop){this.prototype[name]=__jwa__createOverrideChain(prop[name],this.prototype[name]);}};jabberwerx.JWBase.intercept=function(prop){prop=jabberwerx.$.extend(true,{},prop);for(var name in prop){this.prototype[name]=__jwa__createOverrideChain(this.prototype[name],prop[name]);}};jabberwerx.JWBase.extend=function(prop,className){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=__jwa__createOverrideChain(_super[name],prop[name]);};var _superClass=jabberwerx.$.extend({},this);function JWBase(){if(!initializing){if(arguments.length==2&&typeof arguments[0]=='string'&&arguments[0]=='__jw_rehydrate__'){var obj=arguments[1];for(var p in obj){this[p]=obj[p];}}
else{this._guid=jabberwerx.util.newObjectGUID(className||"");this._jwobj_=true;this._className=(typeof className=='undefined'?null:className);this._observerInfo={};for(var p in this){if(typeof this[p]!='function'){this[p]=jabberwerx.util.clone(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}}};for(var name in _superClass){JWBase[name]=_superClass[name];}
JWBase.prototype=prototype;prototype.constructor=JWBase;return JWBase;};jabberwerx.util.Error=function(message){this.message=message;};jabberwerx.util.Error.prototype=new jabberwerx.util.Error();jabberwerx.util.Error.extend=function(message,extension){var f=function(message,extension){this.message=message||this.message;for(var p in extension){this[p]=extension[p];}};f.prototype=new this(message);for(var p in extension){f.prototype[p]=extension[p];}
return f;}
jabberwerx.util.NotSupportedError=jabberwerx.util.Error.extend("This operation is not supported");jabberwerx.util._invocations={};jabberwerx.util.generateInvocation=function(object,methodName,boundArguments){var objectTag='_global_';if(jabberwerx.util.isJWObjRef(object)){objectTag=object._guid;}
var f=jabberwerx.util._invocations[objectTag+'.'+methodName]
if(typeof f!='undefined'){return f;}
if(typeof boundArguments!='undefined'){if(typeof boundArguments!='object'||!(boundArguments instanceof Array)){boundArguments=[boundArguments];}}
else{boundArguments=[];}
var f=function(){return jabberwerx.util.invoke.apply(arguments.callee,[arguments.callee].concat(boundArguments,Array.prototype.slice.call(arguments)));};f.object=object;f.methodName=methodName;f._jwinvocation_=true;jabberwerx.util._invocations[objectTag+'.'+methodName]=f;return f;};jabberwerx.util.invoke=function(){var invocation=arguments[0];var args=Array.prototype.slice.call(arguments,1);if(typeof invocation.object=='undefined'||!invocation.object){return window[invocation.methodName].apply(window,args);}
else{return invocation.object[invocation.methodName].apply(invocation.object,args);}};jabberwerx.util.eventNames=['jw_valueChanged','jw_collectionChanged',];jabberwerx.util.registerEventName=function(name){if(jabberwerx.util.eventNames.indexOf(name)==-1){jabberwerx.util.eventNames.push(name);}
else{throw new jabberwerx.util.EventNameAlreadyRegisteredError('JW event name '+name+' already registered!');}};jabberwerx.util.EventNameAlreadyRegisteredError=jabberwerx.util.Error.extend('That event name is already registered!');jabberwerx.util._objectUIDCounter=0;jabberwerx.util.newObjectGUID=function(className){jabberwerx.util._objectUIDCounter=(jabberwerx.util._objectUIDCounter+1==Number.MAX_VALUE)?0:jabberwerx.util._objectUIDCounter+1;return'_jwobj_'+className.replace(/\./g,"_")+'_'+(new Date().valueOf()+jabberwerx.util._objectUIDCounter).toString();};jabberwerx.util._escapeString=function(str){return('"'+str.replace(/(["\\])/g,'\\$1')+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r");};jabberwerx.util.isString=function(it){return!!arguments.length&&it!=null&&(typeof it=="string"||it instanceof String);};jabberwerx.util.isArray=function(it){return it&&(it instanceof Array||typeof it=="array");};jabberwerx.util._getParts=function(arr,obj,cb){return[jabberwerx.util.isString(arr)?arr.split(""):arr,obj||window,jabberwerx.util.isString(cb)?new Function("item","index","array",cb):cb];};jabberwerx.util.map=function(arr,callback,thisObject){var _p=jabberwerx.util._getParts(arr,thisObject,callback);arr=_p[0];var outArr=(arguments[3]?(new arguments[3]()):[]);for(var i=0;i<arr.length;++i){outArr.push(_p[2].call(_p[1],arr[i],i,arr));}
return outArr;};jabberwerx.util.isJWObjGUID=function(ref){return(typeof ref=='string'&&(ref.indexOf('_jwobj_')==0||ref.indexOf('"_jwobj_')==0));}
jabberwerx.util.isJWObjRef=function(ref){return(ref&&typeof ref=='object'&&typeof ref._jwobj_=='boolean'&&ref._jwobj_);}
jabberwerx.util.isJWInvocation=function(ref){return(ref&&(typeof ref._jwinvocation_!='undefined'));};jabberwerx.util.clone=function(arg){if(typeof arg=='object'&&arg!=null){if(arg instanceof Array){var copy=[];for(var i=0;i<arg.length;i++){copy.push(jabberwerx.util.clone(arg[i]));}}
if(typeof copy=='undefined'){var copy={};}
for(var p in arg){copy[p]=jabberwerx.util.clone(arg[p]);}
if(typeof arg.prototype!='undefined'){copy.prototype=arg.prototype;}}
else{var copy=arg;}
return copy;};jabberwerx.util.slugify=function(string,separator){return string.toLowerCase().replace('-',separator).replace(/[^%a-z0-9 _-]/g,'').replace(/\s+/g,(typeof separator!='undefined'?separator:'-'));};jabberwerx.util.encodeSerialization=function(s){if(s){return jabberwerx.util.crypto.b64Encode(jabberwerx.util.crypto.utf8Encode(s));}
return'';}
jabberwerx.util.decodeSerialization=function(s){if(s){return jabberwerx.util.crypto.utf8Decode(jabberwerx.util.crypto.b64Decode(s));}
return'';}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0)
from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)return from;}
return-1;};}
jabberwerx.util.unserializeXMLDoc=function(s,wrap){if(!s&&!wrap){return null;}
if(typeof wrap=='string'){s='<'+wrap+'>'+s+'</'+wrap+'>';}
var builder=new jabberwerx.NodeBuilder("nbwrapper");builder.xml(s);var unwrapped=builder.data.childNodes[0];builder.data.removeChild(unwrapped);builder.document.removeChild(builder.data);builder.document.appendChild(unwrapped);return builder.document;};jabberwerx.util.unserializeXML=function(s,wrap){var d=jabberwerx.util.unserializeXMLDoc(s,wrap);return(d?d.documentElement:d);};jabberwerx.util.serializeXML=function(n){try{if(n.hasOwnProperty("xml")){return n.xml;}else if(n.getXml){return n.getXml();}else{return jabberwerx.system.serializeXMLToString(n);}}catch(e){return n.xml||null;}};jabberwerx.util.debug={consoleDelegate:null,console:jabberwerx.system.getConsole()||null}
jabberwerx.$.each(['log','dir','warn','error','info','debug'],function(i,e){jabberwerx.util.debug[e]=function(a,streamName){if(!jabberwerx._config.debug.on||(jabberwerx.util.isString(streamName)&&!jabberwerx._config.debug[streamName])){return;}
if(jabberwerx.util.isString(streamName)){a='['+streamName+'] '+a;}
try{jabberwerx.util.debug.console[e](a);}catch(ex){}
if(jabberwerx.util.debug.consoleDelegate){jabberwerx.util.debug.consoleDelegate[e](a);}}});jabberwerx.util.setDebugStream=function(streamName,value){jabberwerx._config.debug[streamName]=(typeof value=='undefined'?true:value);};})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/jwapp/JWModel.js*/
;(function(jabberwerx){jabberwerx.JWModel=jabberwerx.JWBase.extend({init:function(){},shouldBeSavedWithGraph:function(){return true;}},'JWModel');})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/util/crypt.js*/
;(function(jabberwerx){jabberwerx.util.crypto={};jabberwerx.util.crypto.b64Encode=function(input){var table="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var output="";for(var idx=0;idx<input.length;idx+=3){var data=input.charCodeAt(idx)<<16|input.charCodeAt(idx+1)<<8|input.charCodeAt(idx+2);output+=table.charAt((data>>>18)&0x003f)+
table.charAt((data>>>12)&0x003f);output+=((idx+1)<input.length)?table.charAt((data>>>6)&0x003f):"=";output+=((idx+2)<input.length)?table.charAt(data&0x003f):"=";}
return output;};jabberwerx.util.crypto.b64Decode=function(input){var table="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var output="";for(var idx=0;idx<input.length;idx+=4){var h=[table.indexOf(input.charAt(idx)),table.indexOf(input.charAt(idx+1)),table.indexOf(input.charAt(idx+2)),table.indexOf(input.charAt(idx+3))];var data=(h[0]<<18)|(h[1]<<12)|(h[2]<<6)|h[3];if(input.charAt(idx+2)=='='){data=String.fromCharCode((data>>>16)&0x00ff);}else if(input.charAt(idx+3)=='='){data=String.fromCharCode((data>>>16)&0x00ff,(data>>>8)&0x00ff);}else{data=String.fromCharCode((data>>>16)&0x00ff,(data>>>8)&0x00ff,data&0x00ff);}
output+=data;}
return output;};jabberwerx.util.crypto.utf8Encode=function(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(0xD800<=x&&x<=0xDBFF&&0xDC00<=y&&y<=0xDFFF){x=0x10000+((x&0x03FF)<<10)+(y&0x03FF);i++;}
if(x<=0x7F)
output+=String.fromCharCode(x);else if(x<=0x7FF)
output+=String.fromCharCode(0xC0|((x>>>6)&0x1F),0x80|(x&0x3F));else if(x<=0xFFFF)
output+=String.fromCharCode(0xE0|((x>>>12)&0x0F),0x80|((x>>>6)&0x3F),0x80|(x&0x3F));else if(x<=0x1FFFFF)
output+=String.fromCharCode(0xF0|((x>>>18)&0x07),0x80|((x>>>12)&0x3F),0x80|((x>>>6)&0x3F),0x80|(x&0x3F));}
return output;}
jabberwerx.util.crypto.utf8Decode=function(input){var output="";for(idx=0;idx<input.length;idx++){var c=[input.charCodeAt(idx),input.charCodeAt(idx+1),input.charCodeAt(idx+2),input.charCodeAt(idx+3)];var pt;if(0x7f>=c[0]){pt=c[0];}else if(0xc2<=c[0]&&0xdf>=c[0]&&0x80<=c[1]&&0xbf>=c[1]){pt=((c[0]&0x001f)<<6)|(c[1]&0x003f);idx+=1;}else if(((0xe0==c[0]&&0xa0<=c[1]&&0xbf>=c[1])||(0xe1<=c[0]&&0xec>=c[0]&&0x80<=c[1]&&0xbf>=c[1])||(0xed==c[0]&&0x80<=c[1]&&0x9f>=c[1])||(0xee<=c[0]&&0xef>=c[0]&&0x80<=c[1]&&0xbf>=c[1]))&&0x80<=c[2]&&0xbf>=c[2]){pt=((c[0]&0x000f)<<12)|((c[1]&0x003f)<<6)|(c[2]&0x003f);idx+=2;}else if(((0xf0==c[0]&&0x90<=c[1]&&0xbf>=c[1])||(0xf1<=c[0]&&0xf3>=c[0]&&0x80<=c[1]&&0xbf>=c[1])||(0xf4==c[0]&&0x80<=c[1]&&0x8f>=c[1])||(0xf5<=c[0]&&0xf7>=c[0]&&0x80<=c[1]&&0xbf>=c[1]))&&0x80<=c[2]&&0xbf>=c[2]&&0x80<=c[3]&&0xbf>=c[3]){pt=((c[0]&0x0007)<<18)|((c[1]&0x003f)<<12)|((c[2]&0x003f)<<6)|(c[3]&0x003f);idx+=3;}else{throw new Error("invalid UTF-8 at position: "+idx);}
output+=String.fromCharCode(pt);}
return output;};jabberwerx.util.crypto.str2hex=function(input,useUpperCase){var hex_tab=useUpperCase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt((x>>>4)&0x0F)
+hex_tab.charAt(x&0x0F);}
return output;}
jabberwerx.util.crypto.b64_sha1=function(input){return jabberwerx.util.crypto.b64Encode(jabberwerx.util.crypto.str_sha1(input));}
jabberwerx.util.crypto.str_sha1=function(input){var rstr2binb=function(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)
output[i]=0;for(var i=0;i<input.length*8;i+=8)
output[i>>5]|=(input.charCodeAt(i/8)&0xFF)<<(24-i%32);return output;}
var binb2rstr=function(input){var output="";for(var i=0;i<input.length*32;i+=8){output+=String.fromCharCode((input[i>>5]>>>(24-i%32))&0xFF);}
return output;}
var safe_add=function(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);}
var bit_rol=function(num,cnt){return(num<<cnt)|(num>>>(32-cnt));}
var sha1_ft=function(t,b,c,d){if(t<20)return(b&c)|((~b)&d);if(t<40)return b^c^d;if(t<60)return(b&c)|(b&d)|(c&d);return b^c^d;}
var sha1_kt=function(t){return(t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;}
var binb_sha1=function(x,len){x[len>>5]|=0x80<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=bit_rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}
var t=safe_add(safe_add(bit_rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=bit_rol(b,30);b=a;a=t;}
a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde);}
return Array(a,b,c,d,e);}
return binb2rstr(binb_sha1(rstr2binb(input),input.length*8));}
jabberwerx.util.crypto.hex_md5=function(input){return jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(input));}
jabberwerx.util.crypto.rstr_md5=function(input){function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b);}
function md5_ff(a,b,c,d,x,s,t){return md5_cmn((b&c)|((~b)&d),a,b,x,s,t);}
function md5_gg(a,b,c,d,x,s,t){return md5_cmn((b&d)|(c&(~d)),a,b,x,s,t);}
function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t);}
function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|(~d)),a,b,x,s,t);}
var safe_add=function(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);}
var bit_rol=function(num,cnt){return(num<<cnt)|(num>>>(32-cnt));}
var rstr2binl=function(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++){output[i]=0;}
for(var i=0;i<input.length*8;i+=8){output[i>>5]|=(input.charCodeAt(i/8)&0xFF)<<(i%32);}
return output;}
var binl2rstr=function(input){var output="";for(var i=0;i<input.length*32;i+=8){output+=String.fromCharCode((input[i>>5]>>>(i%32))&0xFF);}
return output;}
var binl_md5=function(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);}
return Array(a,b,c,d);}
return binl2rstr(binl_md5(rstr2binl(input),input.length*8));}
jabberwerx.util.crypto.generateUUID=function(){var parts=[];for(var idx=0;idx<16;idx++){parts[idx]=Math.floor(Math.random()*256);}
parts[6]=(parts[6]&0x0f)|0x40;parts[8]=(parts[8]&0x3f)|0x80;var result="";for(var idx=0;idx<parts.length;idx++){var val=parts[idx];if(idx==4||idx==6||idx==8||idx==10){result+="-";}
result+=((val>>>4)&0x0f).toString(16);result+=(val&0x0f).toString(16);}
return result;}})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Translator.js*/
;(function(jabberwerx){jabberwerx.Translator=jabberwerx.JWBase.extend({init:function(){this._super();},format:function(istr){var ostr=this._updates[istr]||this._mappings[istr];if(!ostr){ostr=istr;}
var ptn=/\{([0-9]+)\}/g;var args=jabberwerx.$.makeArray(arguments).slice(1);var substFn=function(match,idx){idx=parseInt(idx);if(isNaN(idx)){return match;}
var found=args[idx];if(found===null||found===undefined){return match;}
return found;};var ostr=ostr.replace(ptn,substFn);return ostr;},load:function(locale){if(!locale){locale=jabberwerx.system.getLocale();}
if(this.locale==locale){return;}
var filterFN=function(l){return function(){var lang=(jabberwerx.$(this).attr("xml:lang")||"").toLowerCase();return(lang==l)?this:null;};};var localeFull=locale.toLowerCase();var localePart=locale.split("-")[0].toLowerCase();var tmpLinks=jabberwerx.$("link[rel='translation'][type='text/javascript']");var links=jabberwerx.$();links=jabberwerx.$.merge(links,tmpLinks.map(filterFN("")));links=jabberwerx.$.merge(links,tmpLinks.map(filterFN(localePart)));links=jabberwerx.$.merge(links,tmpLinks.map(filterFN(localeFull)));if(!links.length){throw new TypeError("no translation links found");}
var mappings={};var processed=0;links.each(function(){var url=jabberwerx.$(this).attr("href");if(!url){return;}
var data=null;var completeFn=function(xhr,status){if(status!="success"){return;}
data=xhr.responseText;};var setup={async:false,cache:true,complete:completeFn,dataType:"text",processData:false,timeout:1000,url:url};jabberwerx.$.ajax(setup);if(!data){jabberwerx.util.debug.log("no translation data returned from "+url);}
try{data=eval("("+data+")");}catch(ex){jabberwerx.util.debug.log("could not parse translation data from "+url);}
mappings=jabberwerx.$.extend(mappings,data);processed++;});if(!processed){throw new TypeError("no valid translations found");}
this._mappings=mappings;this.locale=locale;},addTranslation:function(key,value){if(!(key&&typeof(key)=="string")){throw new TypeError();}
if(!(value&&typeof(value)=="string")){throw new TypeError();}
this._updates[key]=value;},removeTranslation:function(key){if(!(key&&typeof(key)=="string")){throw new TypeError();}
delete this._updates[key];},locale:undefined,_mappings:{},_updates:{}},"jabberwerx.Translator");jabberwerx.l10n=new jabberwerx.Translator();jabberwerx._=(function(l10n){var fn;fn=function(){return l10n.format.apply(l10n,arguments);};fn.instance=l10n;return fn;})(jabberwerx.l10n);try{jabberwerx.l10n.load(jabberwerx.system.getLocale());jabberwerx.util.debug.log("Loaded translation for "+jabberwerx.system.getLocale());}catch(e){jabberwerx.util.debug.log("Could not find a translation for "+jabberwerx.system.getLocale());}})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Rendezvous.js*/
;(function(jabberwerx){jabberwerx.Rendezvousable={startRendezvous:function(ctx){this._rendezvousCtx=ctx;return false;},finishRendezvous:function(){this._rendezvousCtx&&this._rendezvousCtx.finish(this);delete this._rendezvousCtx;},rendezvousContext:null};jabberwerx.Rendezvous=jabberwerx.JWModel.extend({init:function(cb){this._super();if(!(cb&&jabberwerx.$.isFunction(cb))){throw new TypeError("cb must be a function");}
this._callback=cb;},start:function(rnz){this._ready=true;if(jabberwerx.$.inArray(rnz,this._rendezvousers)!=-1){return true;}
if(rnz.startRendezvous&&rnz.startRendezvous(this)){this._rendezvousers.push(rnz);return true;}
return false;},finish:function(rnz){var pos=rnz?jabberwerx.$.inArray(rnz,this._rendezvousers):-1;if(pos!=-1){this._rendezvousers.splice(pos,1);}
if(this._ready&&!this._rendezvousers.length){this._callback(this);this._ready=false;}
return(pos!=-1);},isRunning:function(){return this._ready&&(this._rendezvousers.length>0);},_ready:false,_rendezvousers:[]},"jabberwerx.Rendezvous");})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/SASL.js*/
;(function(jabberwerx){jabberwerx.SASLMechanism=jabberwerx.JWBase.extend({init:function(client,encoded){this._super();this.mechanismName=this.constructor.mechanismName;this._encoded=Boolean(encoded);if(!(client&&client instanceof jabberwerx.Client)){throw new TypeError("client must be a jabberwerx.Client");}
this.client=client;},evaluate:function(input){if(input&&!jabberwerx.isElement(input)){throw new TypeError("input must be undefined or an element");}
var output=null;var failure=null;var data;if(!input){if(this.started){jabberwerx.util.debug.log("SASL mechanism already started!");throw this._handleFailure();}
this.started=true;try{data=this.evaluateStart();data=this._encodeData(data);output=new jabberwerx.NodeBuilder("{urn:ietf:params:xml:ns:xmpp-sasl}auth").attribute("mechanism",this.mechanismName).text(data).data;}catch(ex){jabberwerx.util.debug.log("SASL failed to initialize: "+ex);throw this._handleFailure(ex);}}else{if(!this.started){jabberwerx.util.debug.log("SASL mechanism not yet started!");throw this._handleFailure();}
switch(input.nodeName){case"success":try{if(!this.complete){data=jabberwerx.$(input).text();data=this._decodeData(data);data=this.evaluateChallenge(data);}}catch(ex){jabberwerx.util.debug.log("SASL failed to evaluate success data: "+ex);throw this._handleFailure(ex);}
if(data||!this.complete){jabberwerx.util.debug.log("SASL failed to complete upon <success/>");throw this._handleFailure();}
break;case"failure":{var failure=this._handleFailure(jabberwerx.$(input).children().get(0));jabberwerx.util.debug.log("SASL failure from server: "+failure.message);throw failure;}
break;case"challenge":if(this.complete){jabberwerx.util.debug.log("SASL received challenge after completion!");throw this._handleFailure();}
try{data=jabberwerx.$(input).text();data=this._decodeData(data);data=this.evaluateChallenge(data);data=this._encodeData(data);output=new jabberwerx.NodeBuilder("{urn:ietf:params:xml:ns:xmpp-sasl}response").text(data).data;}catch(ex){jabberwerx.util.debug.log("SASL failed to evaluate challenge data: "+ex);throw this._handleFailure(ex);}
break;default:jabberwerx.util.debug.log("unexpected stanza received!");throw this._handleFailure();break;}}
return output;},_decodeData:function(data){if(!data){return"";}
if(!this._encoded){return jabberwerx.util.crypto.utf8Decode(jabberwerx.util.crypto.b64Decode(data));}
return data;},_encodeData:function(data){if(!data){return"";}
if(!this._encoded){return jabberwerx.util.crypto.b64Encode(jabberwerx.util.crypto.utf8Encode(data));}
return data;},evaluateStart:function(){throw new Error("not implemented!");},evaluateChallenge:function(inb){throw new Error("not implemented!");},_handleFailure:function(cond){this.complete=true;if(cond instanceof jabberwerx.SASLMechanism.SASLAuthFailure){return cond;}else if(jabberwerx.isElement(cond)){var msg="{urn:ietf:params:xml:ns:xmpp-sasl}"+cond.nodeName;return new jabberwerx.SASLMechanism.SASLAuthFailure(msg);}else{return new jabberwerx.SASLMechanism.SASLAuthFailure();}},getProperties:function(){return(this.client&&this.client._connectParams)||{};},client:null,mechanismName:"",complete:false,started:false},"jabberwerx.SASLMechanism");jabberwerx.SASLMechanism.SASLAuthFailure=jabberwerx.util.Error.extend("{urn:ietf:params:xml:ns:xmpp-sasl}temporary-auth-failure");jabberwerx.SASLMechanism._baseExtend=jabberwerx.SASLMechanism.extend;jabberwerx.SASLMechanism.extend=function(props,type,mechname){if(!(mechname&&typeof(mechname)=="string")){throw new TypeError("name must be a non-empty string");}
var subtype=jabberwerx.SASLMechanism._baseExtend(props,type);subtype.mechanismName=mechname.toUpperCase();if(jabberwerx.sasl&&jabberwerx.sasl instanceof jabberwerx.SASLMechanismFactory){jabberwerx.sasl.addMechanism(subtype);}
return subtype;};jabberwerx.SASLMechanismFactory=jabberwerx.JWBase.extend({init:function(mechs){this._super();if(!mechs){if(jabberwerx._config.enabledMechanisms){mechs=jabberwerx._config.enabledMechanisms;}else{mechs=[];}}
this.mechanisms=mechs.concat();},createMechanismFor:function(client,mechs){if(!jabberwerx.$.isArray(mechs)){throw new TypeError("mechs must be an array of mechanism names");}
if(!(client&&client instanceof jabberwerx.Client)){throw new TypeError("client must be an isntance of jabberwerx.Client");}
mechs=mechs.concat();for(var idx=0;idx<mechs.length;idx++){mechs[idx]=String(mechs[idx]).toUpperCase();}
var selected=null;for(var idx=0;!selected&&idx<this.mechanisms.length;idx++){var candidate=this._mechsAvail[this.mechanisms[idx]];if(!candidate){continue;}
for(var jdx=0;!selected&&jdx<mechs.length;jdx++){if(mechs[jdx]!=candidate.mechanismName){continue;}
try{selected=new candidate(client);}catch(ex){jabberwerx.util.debug.log("could not create SASLMechanism for "+
candidate.mechanismName+": "+ex);selected=null;}}}
return selected;},addMechanism:function(type){if(!(jabberwerx.$.isFunction(type)&&type.mechanismName)){throw new TypeError("type must be the constructor for a SASLMechanism type");}
this._mechsAvail[type.mechanismName]=type;},removeMechanism:function(type){if(!(jabberwerx.$.isFunction(type)&&type.mechanismName)){throw new TypeError("type must be the constructor for a SASLMechanism type");}
this._mechsAvail[type.mechanismName]=undefined;delete this._mechsAvail[type.mechanismName];},_mechsAvail:{},mechanisms:[]},"jabberwerx.SASLMechanismFactory");if(!(jabberwerx.sasl&&jabberwerx.sasl instanceof jabberwerx.SASLMechanismFactory)){jabberwerx.sasl=new jabberwerx.SASLMechanismFactory(jabberwerx._config.enabledMechanisms);}})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/SASLMechs.js*/
;(function(jabberwerx){jabberwerx.SASLPlainMechanism=jabberwerx.SASLMechanism.extend({init:function(client){this._super(client);},evaluateStart:function(){var params=this.getProperties();if(!this.client.isSecure()){throw new jabberwerx.SASLMechanism.SASLAuthFailure("{urn:ietf:params:xml:ns:xmpp-sasl}mechanism-too-weak");}
var nilChar=String.fromCharCode(0);var usr=(params&&params.jid&&params.jid.getNode())||"";var pwd=(params&&params.password)||"";return nilChar+usr+nilChar+pwd;},evaluateChallenge:function(inb){if(inb||this.complete){throw new jabberwerx.SASLMechanism.SASLAuthFailure();}
this.complete=true;}},"jabberwerx.SASLPlainMechanism","PLAIN");jabberwerx.SASLDigestMd5Mechanism=jabberwerx.SASLMechanism.extend({init:function(client){this._super(client);},evaluateStart:function(){this._stage=this._generateResponse;return null;},evaluateChallenge:function(inb){var inprops,outprops;if(this.complete&&!this._stage){return;}
if(!this._stage){jabberwerx.util.debug.log("DIGEST-MD5 in bad stage");throw new jabberwerx.SASLMechanism.SASLAuthFailure();}
inprops=this._decodeProperties(inb);outprops=this._stage(inprops);return this._encodeProperties(outprops);},_generateResponse:function(inprops){var params=this.getProperties();var user,pass,domain;user=(params.jid&&params.jid.getNode())||"";domain=(params.jid&&params.jid.getDomain())||"";pass=params.password||"";var realm=inprops.realm||domain;var nonce=inprops.nonce;var nc=inprops.nc||"00000001";var cnonce=this._cnonce((user+"@"+realm).length);var uri="xmpp/"+domain;var qop="auth";var A1;A1=jabberwerx.util.crypto.rstr_md5(jabberwerx.util.crypto.utf8Encode(user+":"+realm+":"+pass));A1=A1+jabberwerx.util.crypto.utf8Encode(":"+nonce+":"+cnonce);var A2;A2=jabberwerx.util.crypto.utf8Encode("AUTHENTICATE:"+uri);var rsp=[jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(A1)),nonce,nc,cnonce,qop,jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(A2))].join(":");rsp=jabberwerx.util.crypto.hex_md5(jabberwerx.util.crypto.utf8Encode(rsp));var outprops={"charset":"utf-8","digest-uri":uri,"cnonce":cnonce,"nonce":nonce,"nc":nc,"qop":qop,"username":user,"realm":realm,"response":rsp};this._authProps=outprops;this._stage=this._verifyRspAuth;return outprops;},_verifyRspAuth:function(inprops){if(inprops){inprops=jabberwerx.$.extend({},inprops,this._authProps||{});var params=this.getProperties();var user,pass,domain;user=(params.jid&&params.jid.getNode())||"";domain=(params.jid&&params.jid.getDomain())||"";pass=params.password||"";var realm=inprops.realm||domain;var nonce=inprops.nonce;var nc=inprops.nc||"00000001";var cnonce=inprops.cnonce;var uri="xmpp/"+domain;var qop="auth";var A1;A1=jabberwerx.util.crypto.rstr_md5(jabberwerx.util.crypto.utf8Encode(user+":"+realm+":"+pass));A1=A1+jabberwerx.util.crypto.utf8Encode(":"+nonce+":"+cnonce);var A2;A2=jabberwerx.util.crypto.utf8Encode(":"+uri);var rsp=[jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(A1)),nonce,nc,cnonce,qop,jabberwerx.util.crypto.str2hex(jabberwerx.util.crypto.rstr_md5(A2))].join(":");rsp=jabberwerx.util.crypto.hex_md5(jabberwerx.util.crypto.utf8Encode(rsp));if(rsp!=inprops.rspauth){jabberwerx.util.debug.log("response auth values do not match");throw new jabberwerx.SASLMechanism.SASLAuthFailure();}}
this.complete=true;this._stage=null;},_decodeProperties:function(str){var ptn=/([^"()<>\{\}\[\]@,;:\\\/?= \t]+)=(?:([^"()<>\{\}\[\]@,;:\\\/?= \t]+)|(?:"([^"]+)"))/g;var props={};var field;if(!str){str="";}
while(field=ptn.exec(str)){props[field[1]]=field[2]||field[3]||"";}
return props;},_encodeProperties:function(props){var quoted={"username":true,"realm":true,"nonce":true,"cnonce":true,"digest-uri":true,"response":true};var tmp=[];for(var name in props){var val=quoted[name]?'"'+props[name]+'"':props[name];tmp.push(name+"="+val);}
return tmp.join(",");},_stage:null,_cnonce:function(size){var data="";for(var idx=0;idx<size;idx++){data+=String.fromCharCode(Math.random()*256);}
return jabberwerx.util.crypto.b64Encode(data);}},"jabberwerx.SASLDigestMd5Mechanism","DIGEST-MD5");})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/JID.js*/
;(function(jabberwerx){var _jidCache={};var _lookupCache=function(val){if(!val){throw new jabberwerx.JID.InvalidJIDError();}
val=val.toString();var jid=_jidCache[val];if(jid){return jid;}
var resSep=val.lastIndexOf('/');val=(resSep!=-1)?val.substring(0,resSep).toLowerCase()
+"/"+val.substring(resSep+1):val.toLowerCase();jid=_jidCache[val];if(jid){return jid;}
return null;};jabberwerx.JID=jabberwerx.JWModel.extend({init:function(arg){if(arg instanceof jabberwerx.JID){arg={"node":arg.getNode()||null,"domain":arg.getDomain()||null,"resource":arg.getResource()||null};}else if(typeof(arg)=="string"){var result=/^(?:([^\/]+)@)?([^@\/]+)(?:\/(.+))?$/.exec(arg);if(!result){throw new jabberwerx.JID.InvalidJIDError("JID did not match the form 'node@domain/resource'");}
arg={"node":(result[1]||undefined),"domain":result[2],"resource":(result[3]||undefined)};}else if(!arg){throw new jabberwerx.JID.InvalidJIDError("argument must be defined and not null");}else{arg=jabberwerx.$.extend({},arg);}
var prepFN=function(test){if(/[ \t\n\r@\:\<\>\&'"\/]/.test(test)){throw new jabberwerx.JID.InvalidJIDError("invalid characters found");}
return test.toLowerCase();};if(!arg.domain){throw new jabberwerx.JID.InvalidJIDError("'' or null or undefined domain not allowed");}else{arg.domain=prepFN(arg.domain,true);}
if(arg.node==""){throw new jabberwerx.JID.InvalidJIDError("'' node with @ not allowed");}else if(arg.node){if(arg.unescaped){arg.node=jabberwerx.JID.escapeNode(arg.node);}
arg.node=prepFN(arg.node,true);}
if(arg.resouce==""){throw new jabberwerx.JID.InvalidJIDError("'' resource with / not allowed");}
this._domain=arg.domain;this._node=arg.node||"";this._resource=arg.resource||"";this._full=""+
(arg.node?arg.node+"@":"")+
arg.domain+
(arg.resource?"/"+arg.resource:"");if(!_jidCache[this.toString()]){_jidCache[this.toString()]=this;}},getBareJID:function(){if(!this.getResource()){return this;}else{return new jabberwerx.JID({"node":this.getNode(),"domain":this.getDomain()});}},getBareJIDString:function(){return this.getBareJID().toString();},getDomain:function(){return this._domain;},getNode:function(){return this._node;},getResource:function(){return this._resource;},toString:function(){return this._full;},toDisplayString:function(){var result=this.getDomain();var part;part=this.getNode();if(part){result=jabberwerx.JID.unescapeNode(part)+"@"+result;}
part=this.getResource();if(part){result=result+"/"+part;}
return result;},equals:function(jid){try{jid=jabberwerx.JID.asJID(jid);return this.toString()==jid.toString();}catch(ex){return false;}},compareTo:function(jid){jid=jabberwerx.JID.asJID(jid);var cmp=function(v1,v2){if(v1<v2){return-1;}else if(v1>v2){return 1;}
return 0;};var result;if((result=cmp(this.getDomain(),jid.getDomain()))!=0){return result;}
if((result=cmp(this.getNode(),jid.getNode()))!=0){return result;}
if((result=cmp(this.getResource(),jid.getResource()))!=0){return result;}
return 0;},shouldBeSerializedInline:function(){return false;},wasUnserialized:function(){_jidCache[this.toString()]=this;},_node:"",_domain:"",_resource:"",_full:""},'jabberwerx.JID');jabberwerx.JID.InvalidJIDError=jabberwerx.util.Error.extend.call(TypeError,"The JID is invalid");jabberwerx.JID.asJID=function(val){var jid=null;if(val instanceof jabberwerx.JID){return val;}
jid=_lookupCache(val);if(!jid){jid=new jabberwerx.JID(val);var lookup=jid.toString();if(_jidCache[lookup]&&_jidCache[lookup]!=jid){jid=_jidCache[lookup];}else{_jidCache[lookup]=jid;}
_jidCache[val.toString()]=jid;}
return jid;};jabberwerx.JID.clearCache=function(){_jidCache={};},jabberwerx.JID.escapeNode=function(input){if(typeof(input)!="string"){throw new TypeError("input must be a string");}
if(input.charAt(0)==' '||input.charAt(input.length-1)==' '){throw new TypeError("input cannot start or end with ' '");}
var ptn=/([ "&'\/:<>@])|(\\)(20|22|26|27|2f|3a|3c|3e|40|5c)/gi;var repFN=function(found,m1,m2,m3){switch(m1||m2){case' ':return"\\20";case'"':return"\\22";case'&':return"\\26";case'\'':return"\\27";case'/':return"\\2f";case':':return"\\3a";case'<':return"\\3c";case'>':return"\\3e";case'@':return"\\40";case'\\':return"\\5c"+m3;}
return found;};return input.replace(ptn,repFN);};jabberwerx.JID.unescapeNode=function(input){if(typeof(input)!="string"){throw new TypeError("input must be a string");}
var ptn=/(\\20|\\22|\\26|\\27|\\2f|\\3a|\\3c|\\3e|\\40|\\5c)/gi;var repFN=function(found,m1){switch(m1){case"\\20":return' ';case"\\22":return'"';case"\\26":return'&';case"\\27":return'\'';case"\\2f":return'/';case"\\3a":return':';case"\\3c":return'<';case"\\3e":return'>';case"\\40":return'@';case"\\5c":return'\\';}
return found;};return input.replace(ptn,repFN);};var tjid=jabberwerx.JID.asJID("foo");if((tjid+"")!=="foo"){jabberwerx.JID.prototype.toString=function(){return this._full||"";};}})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Events.js*/
;(function(jabberwerx){var _jwaNotifierBinding=function(dispatch,name,mode){var key='on:'+name.toLowerCase();var notifier=dispatch[key];if(!notifier&&(mode=='create')){notifier=new jabberwerx.EventNotifier(dispatch,name);dispatch[key]=notifier;}else if(notifier&&(mode=='destroy')){delete dispatch[key];}
return notifier;};var _jwaDispatchBinding=function(src,name,mode){var dispatch=(src instanceof jabberwerx.EventDispatcher)?src:src._eventDispatch;if(!(dispatch&&dispatch instanceof jabberwerx.EventDispatcher)){if(mode!='create'){return;}
dispatch=new jabberwerx.EventDispatcher(src);src._eventDispatch=dispatch;}
return _jwaNotifierBinding(dispatch,name,mode);};jabberwerx.EventObject=function(notifier,data){this.notifier=notifier;this.name=notifier.name;this.source=notifier.dispatcher.source;this.data=data;this.selected=undefined;};jabberwerx.EventNotifier=jabberwerx.JWBase.extend({init:function(dispatcher,name){this._super();this.dispatcher=dispatcher;this.name=name.toLowerCase();this._callbacks=[];},bind:function(cb){this.bindWhen(undefined,cb);},bindWhen:function(selector,cb){if(!jabberwerx.$.isFunction(cb)){new TypeError("callback must be a function");}
this.unbind(cb);switch(typeof selector){case'undefined':break;case'function':break;case'string':var filter=selector;selector=function(data,evt){var node;if(data instanceof jabberwerx.Stanza){node=data.getDoc();}else{node=data;}
var selected=jabberwerx.$(filter,node);switch(selected.length){case 0:return false;case 1:return selected[0];default:return selected;}
return false;};break;default:throw new TypeError("selector must be undefined or function or string");}
this._callbacks.push({'filter':filter,'selector':selector,'cb':cb});},unbind:function(cb){this._callbacks=jabberwerx.$.grep(this._callbacks,function(value){return value['cb']!==cb;});},trigger:function(data,delegated,cb){var evt;if(data instanceof jabberwerx.EventObject){evt=data;evt.notifier=this;}else{evt=new jabberwerx.EventObject(this,data);}
if(!delegated){delegated=_jwaNotifierBinding(jabberwerx.globalEvents,this.name);}else if(!(delegated instanceof jabberwerx.EventNotifier)){throw new TypeError("delegated must be a EventNotifier");}
if(cb&&!jabberwerx.$.isFunction(cb)){throw new TypeError("cb must be a function");}
return this.dispatcher.process(this,evt,delegated,cb);},process:function(evt,delegated,cb){var results=false;jabberwerx.reduce(this._callbacks,function(item){var cb=item['cb'];var filter=item['selector'];var retval;if(!cb||!jabberwerx.$.isFunction(cb)){return;}
var selected=undefined;if(filter){selected=filter(evt.data);if(!selected){return;}}
try{evt.selected=selected;retval=cb.call(cb,evt);}catch(ex){}
if(retval!==undefined){results=results||Boolean(retval);}});if(delegated&&delegated!==this){var fn=function(delegatedResults){results=results||delegatedResults;if(cb){cb(results);}};delegated.trigger(evt,null,fn);}else if(cb){cb(results);}},shouldBeSavedWithGraph:function(){return true;},wasUnserialized:function(){var callbacks=this._callbacks;callbacks=jabberwerx.$.map(callbacks,function(oneCB,oneKey){if(jabberwerx.util.isJWInvocation(oneCB.cb)){var method=oneCB.cb.methodName,target=oneCB.cb.object;if(!(target&&method&&target[method])){jabberwerx.util.debug.log("throwing out bad callback: "+target+"["+method+"]");return null;}}
if(oneCB.filter&&!oneCB.selector&&(typeof oneCB.filter=='string')){var oneFilter=oneCB.filter;oneCB.selector=function(data,evt){var node;if(data instanceof jabberwerx.Stanza){node=data.getDoc();}else{node=data;}
var selected=jabberwerx.$(oneFilter,node);switch(selected.length){case 0:return false;case 1:return selected[0];default:return selected;}
return false;};}
return oneCB;});this._callbacks=callbacks;}},"jabberwerx.EventNotifier");jabberwerx.EventDispatcher=jabberwerx.JWBase.extend({init:function(src){this._super();this.source=src;if(src!==jabberwerx&&jabberwerx.globalEvents){this.globalEvents=jabberwerx.globalEvents;}},process:function(notifier,evt,delegated,cb){var op={notifier:notifier,event:evt,delegated:delegated,callback:cb};if(this._queue){this._queue.push(op);return;}
this._queue=[op];while(op=this._queue.shift()){op.notifier.process(op.event,op.delegated,op.callback);}
delete this._queue;},shouldBeSavedWithGraph:function(){return true;},wasUnserialized:function(){jabberwerx.globalEvents=this.globalEvents;}},"jabberwerx.EventDispatcher");jabberwerx.GlobalEventDispatcher=jabberwerx.EventDispatcher.extend({init:function(){this._super(jabberwerx);if(jabberwerx.globalEvents&&jabberwerx.globalEvents!==this){throw new Error("only one global events dispatcher can exist!");}},bind:function(name,cb){var notifier=_jwaNotifierBinding(this,name,'create');notifier.bind(cb);},bindWhen:function(name,selector,cb){var notifier=_jwaNotifierBinding(this,name,'create');notifier.bindWhen(selector,cb);},unbind:function(name,cb){var notifier=_jwaNotifierBinding(this,name);if(notifier){notifier.unbind(cb);}},shouldBeSerializedInline:function(){return false;},shouldBeSavedWithGraph:function(){return true;},willBeSerialized:function(){this.source=undefined;},wasUnserialized:function(){this.source=jabberwerx;}},"jabberwerx.GlobalEventDispatcher");if(!(jabberwerx.globalEvents&&jabberwerx.globalEvents instanceof jabberwerx.GlobalEventDispatcher)){jabberwerx.globalEvents=new jabberwerx.GlobalEventDispatcher();}
jabberwerx.JWModel.prototype.event=function(name){return _jwaDispatchBinding(this,name);};jabberwerx.JWModel.prototype.applyEvent=function(name){return _jwaDispatchBinding(this,name,'create');};})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Entity.js*/
;(function(jabberwerx){var __jwesAsKey=function(jid,node){return"["+(jid||"")+"]:["+(node||"")+"]";};jabberwerx.Entity=jabberwerx.JWModel.extend({init:function(key,ctrl){this._super();if(!key&&!(key.jid||key.node)){throw new TypeError("key must contain a jid and/or a node");}
if(key.jid){this.jid=jabberwerx.JID.asJID(key.jid);}
if(key.node){this.node=key.node;}
this._mapKey=__jwesAsKey(this.jid,this.node);var cache;if(ctrl instanceof jabberwerx.Controller){this.controller=ctrl;cache=ctrl.client&&ctrl.client.entitySet;}else if(ctrl&&ctrl.register&&ctrl.unregister&&ctrl.entity){cache=ctrl;}
if(cache){this.cache=cache;this._eventing={"added":cache.event("entityCreated"),"updated":cache.event("entityUpdated"),"deleted":cache.event("entityDestroyed")};}else{this._eventing={"added":null,"updated":null,"deleted":null};}
this.applyEvent('primaryPresenceChanged');this.applyEvent("resourcePresenceChanged");},destroy:function(){if(this.cache){this.cache.unregister(this);}
this._super();},apply:function(entity,noupdate){if(!(entity&&entity instanceof jabberwerx.Entity)){throw new TypeError("entity is not valid");}
jabberwerx.$.extend(this,{_displayName:entity._displayName,_groups:jabberwerx.$.extend([],entity._groups),_presenceList:jabberwerx.$.extend([],entity._presenceList),properties:jabberwerx.$.extend(true,{},entity.properties),features:jabberwerx.$.extend([],entity.features),identities:jabberwerx.$.extend([],entity.identities)});if(!noupdate){this.update();}
return this;},__toStringValue:function(){return"entity<"+this.getClassName()+">["+
this._mapKey+"]: "+
this.getDisplayName();},matches:function(entity){if(entity===this){return true;}
if(!entity){return false;}
return this._mapKey==entity._mapKey;},isActive:function(){return(this._presenceList.length>0&&this._presenceList[0].getType()!="unavailable");},getPrimaryPresence:function(){return this._presenceList[0]||null;},getAllPresence:function(){return this._presenceList;},getResourcePresence:function(resource){var fullJid=this.jid.getBareJIDString()+'/'+resource;var presence=null;jabberwerx.$.each(this._presenceList,function(){if(this.getFrom()==fullJid){presence=this;return false;}
return true;});return presence;},updatePresence:function(presence,quiet){var retVal=false;if(!presence){if(this.getPrimaryPresence()){var len=this._presenceList.length;for(var i=0;i<len;i++){var tpres=this._presenceList.pop();!quiet&&this.event("resourcePresenceChanged").trigger({fullJid:tpres.getFromJID(),presence:null,nowAvailable:false});}!quiet&&this.event("primaryPresenceChanged").trigger({presence:null,fullJid:this.jid.getBareJID()});retVal=true;}}else{if(!(presence instanceof jabberwerx.Presence)){throw new TypeError("presence is not a valid type");}
var jid=presence.getFromJID();if(jid.getBareJIDString()!=this.jid.getBareJIDString()){throw new jabberwerx.Entity.InvalidPresenceError("presence is not for this entity: "+this);}
if(presence.getType()&&presence.getType()!="unavailable"){throw new jabberwerx.Entity.InvalidPresenceError("presence is not the correct type");}
var resPresence=this.getResourcePresence(jid.getResource());var nowAvailable;if(!resPresence||resPresence.getType()=="unavailable"){nowAvailable=Boolean(!presence.getType());}else{nowAvailable=false;}
var primaryPresence=this._presenceList[0]||null;this._removePresenceFromList(jid.toString());if(presence.getType()!="unavailable"){if(!this.isActive()){this._clearPresenceList();}
this._insertPresence(presence);}else{this._handleUnavailable(presence);}!quiet&&this.event("resourcePresenceChanged").trigger({fullJid:jid,presence:presence,nowAvailable:nowAvailable});if(primaryPresence!==this._presenceList[0]){var primaryJid;primaryPresence=this._presenceList[0]||null;primaryJid=primaryPresence?primaryPresence.getFromJID():jid.getBareJID();!quiet&&this.event("primaryPresenceChanged").trigger({presence:primaryPresence,fullJid:primaryJid});retVal=true;}}
return retVal;},_handleUnavailable:function(presence){},_insertPresence:function(presence){var ipos;for(ipos=0;(ipos<this._presenceList.length)&&(presence.compareTo(this._presenceList[ipos])<0);++ipos);this._presenceList.splice(ipos,0,presence);},_clearPresenceList:function(){this._presenceList=[];},_removePresenceFromList:function(jid){for(var i=0;i<this._presenceList.length;i++){if(this._presenceList[i].getFrom()==jid){this._presenceList.splice(i,1);return true;}}
return false;},getDisplayName:function(){var name=this._displayName;if(!name){var jid=(this.jid&&this.jid.toDisplayString());name=(this.node?"{"+this.node+"}":"")+(jid||"");}
return name;},setDisplayName:function(name){var nval=(String(name)||"");var oval=this._displayName;if(oval!=nval){this._displayName=nval;this.update();}},_displayName:"",getGroups:function(){return this._groups;},setGroups:function(groups){if(jabberwerx.$.isArray(groups)){groups=jabberwerx.unique(groups.concat([]));}else if(groups){groups=[groups.toString()];}else{groups=[];}
this._groups=groups;this.update();},_groups:[],update:function(){if(this.controller&&this.controller.updateEntity){this.controller.updateEntity(this);}else if(this._eventing["updated"]){this._eventing["updated"].trigger(this);}},remove:function(){if(this.controller&&this.controller.removeEntity){this.controller.removeEntity(this);}else{this.destroy();}},hasFeature:function(feat){if(!feat){return false;}
var result=false;jabberwerx.$.each(this.features,function(){result=String(this)==feat;return!result;});return result;},hasIdentity:function(id){if(!id){return false;}
var result=false;jabberwerx.$.each(this.identities,function(){result=String(this)==id;return!result;});return result;},toString:function(){return this.__toStringValue();},jid:null,node:"",properties:{},features:[],identities:[],_presenceList:[]},'jabberwerx.Entity');jabberwerx.Entity.InvalidPresenceError=jabberwerx.util.Error.extend("The provided presence is not valid for this entity");jabberwerx.EntitySet=jabberwerx.JWModel.extend({init:function(){this._super();this.applyEvent("entityCreated");this.applyEvent("entityDestroyed");this.applyEvent("entityUpdated");this.applyEvent("entityRenamed");this.applyEvent("entityAdded");this.applyEvent("entityRemoved");this.applyEvent("batchUpdateStarted");this.applyEvent("batchUpdateEnded");},entity:function(jid,node){return this._map[__jwesAsKey(jid,node)];},register:function(entity){if(!(entity&&entity instanceof jabberwerx.Entity)){throw new TypeError("entity is not an Entity");}
var prev=this.entity(entity.jid,entity.node);if(prev===entity){return false;}
if(prev){this.unregister(prev);}
this._updateToMap(entity);this.event("entityAdded").trigger(entity);return true;},unregister:function(entity){var present=(this.entity(entity.jid,entity.node)!==undefined);this._removeFromMap(entity);if(present){this.event("entityRemoved").trigger(entity);}
return present;},_renameEntity:function(entity,njid,nnode){var ojid=entity.jid;var onode=entity.node;this._removeFromMap(entity);if(njid){njid=jabberwerx.JID.asJID(njid);}else{njid=undefined;}
entity.jid=njid;if(nnode){nnode=String(nnode);}else{nnode=undefined;}
entity.node=nnode;this._updateToMap(entity);var data={entity:entity,jid:ojid,node:nnode};this.event("entityRenamed").trigger(data);},each:function(op,entityClass){if(!jabberwerx.$.isFunction(op)){throw new TypeError('operator must be a function');}
var that=this;jabberwerx.$.each(this._map,function(){var retcode;if(this instanceof(entityClass||jabberwerx.Entity)){retcode=op(this);}
return(retcode!=false);});},toArray:function(){var arr=[];this.each(function(entity){arr.push(entity);});return arr;},getAllGroups:function(){var groups=[];this.each(function(entity){jabberwerx.$.merge(groups,entity.getGroups());});return jabberwerx.unique(groups);},_map:{},_updateToMap:function(ent){var key=__jwesAsKey(ent.jid,ent.node);ent._mapKey=key;this._map[key]=ent;},_removeFromMap:function(ent){delete this._map[__jwesAsKey(ent.jid,ent.node)];},_batchCount:0,_batchQueue:[],startBatch:function(){var count=this._batchCount;this._batchCount++;if(count==0){this._enableBatchTriggers(true);this._batchQueue=[];this.event("batchUpdateStarted").trigger();}
return(count!=0);},endBatch:function(){var running=true;switch(this._batchCount){case 0:running=false;break;case 1:running=false;this._enableBatchTriggers(false);var bq=this._batchQueue;this._batchQueue=[];this.event("batchUpdateEnded").trigger(bq);default:this._batchCount--;break;}
return running;},_addBatchedEvent:function(notifier,edata){this._batchQueue.push({name:notifier.name,data:edata});},_enableBatchTriggers:function(enable){var that=this;jabberwerx.$.each(["entityCreated","entityDestroyed","entityRenamed","entityUpdated","entityAdded","entityRemoved"],function(){var notifier=that.event(this);if(!enable&&notifier._superTrigger){notifier.trigger=notifier._superTrigger;delete notifier._superTrigger;}else if(enable&&!notifier._superTrigger){notifier._superTrigger=notifier.trigger;notifier.trigger=function(data){that._addBatchedEvent(notifier,data);return(!that.suppressBatchedEvents&&notifier._superTrigger.apply(notifier,arguments));}}});},suppressBatchedEvents:false},'jabberwerx.EntitySet');jabberwerx.EntitySet.EntityAlreadyExistsError=jabberwerx.util.Error.extend('That JID is already taken!.');})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/TemporaryEntity.js*/
;(function(jabberwerx){jabberwerx.TemporaryEntity=jabberwerx.Entity.extend({init:function(jid,cache){this._super({jid:jid},cache);}},'jabberwerx.TemporaryEntity');})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Stanza.js*/
;(function(jabberwerx){jabberwerx.Stanza=jabberwerx.JWModel.extend({init:function(root){this._super();var builder=new jabberwerx.NodeBuilder();if(jabberwerx.isElement(root)){builder=builder.node(root);}else if(typeof(root)=="string"){if(!(/^\{[^\}]*\}/.test(root))){root="{jabber:client}"+root;}
builder=builder.element(root);}else{throw new TypeError("root must be an element or expanded-name");}
this._DOM=builder.data;var date=new Date();var dateString=jabberwerx.$(builder.data).find("delay[xmlns='urn:xmpp:delay'][stamp]").attr("stamp");if(!dateString){dateString=jabberwerx.$(builder.data).find("x[xmlns='jabber:x:delay'][stamp]").attr("stamp");}
if(dateString){try{date=jabberwerx.parseTimestamp(dateString);}catch(ex){jabberwerx.util.debug.log("could not parse delay: "+ex);}}
this.timestamp=date;},getNode:function(){return this._DOM;},getDoc:function(){return this.getNode().ownerDocument;},xml:function(){return jabberwerx.util.serializeXML(this._DOM);},pType:function(){return this.getNode().nodeName;},_getAttrValue:function(name){return this.getNode().getAttribute(name);},_setAttrValue:function(name,val){if(val===undefined||val===null){this.getNode().removeAttribute(name);}else{this.getNode().setAttribute(name,val);}},_getChildText:function(name){var nnode=new jabberwerx.NodeBuilder(name).data;var nodens=(nnode.namespaceURI)?nnode.namespaceURI:this.getNode().namespaceURI;var matches=jabberwerx.$(this.getNode()).children(nnode.nodeName).map(function(idx,child){return child.namespaceURI==nodens?child:null;});return matches.length?jabberwerx.$(matches[0]).text():null;},_setChildText:function(name,val){var n=jabberwerx.$(this.getNode()).children(name);if(val===undefined||val===null){n.remove();}else{if(!n.length){n=jabberwerx.$(new jabberwerx.NodeBuilder(this.getNode()).element(name).data);}
n.text(val);}},getType:function(){return this._getAttrValue("type");},setType:function(type){this._setAttrValue("type",type||undefined);},getID:function(){return this._getAttrValue("id");},setID:function(id){this._setAttrValue("id",id||undefined);},getFrom:function(){return this._getAttrValue("from")||null;},getFromJID:function(){var addr=this.getFrom();if(addr){try{addr=jabberwerx.JID.asJID(addr);}catch(ex){jabberwerx.util.debug.log("could not parse 'from' address: "+ex);addr=null;}}
return addr;},setFrom:function(addr){addr=(addr)?jabberwerx.JID.asJID(addr):undefined;this._setAttrValue("from",addr);},getTo:function(){return this._getAttrValue("to")||null;},getToJID:function(){var addr=this.getTo();if(addr){try{addr=jabberwerx.JID.asJID(addr);}catch(ex){jabberwerx.util.debug.log("could not parse 'to' address: "+ex);addr=null;}}
return addr;},setTo:function(addr){addr=(addr)?jabberwerx.JID.asJID(addr):undefined;this._setAttrValue("to",addr);},isError:function(){return this.getType()=="error";},getErrorInfo:function(){var err=jabberwerx.$(this.getNode()).children("error");if(this.isError()&&err.length){err=jabberwerx.Stanza.ErrorInfo.createWithNode(err.get(0));}else{err=null;}
return err;},clone:function(){var cpy=jabberwerx.Stanza.createWithNode(this.getNode());cpy.timestamp=this.timestamp;return cpy;},swap:function(include_from){var cpy=this.clone();cpy.setTo(this.getFromJID());cpy.setFrom(include_from?this.getToJID():null);return cpy;},errorReply:function(err){if(!(err&&err instanceof jabberwerx.Stanza.ErrorInfo)){throw new TypeError("err must be an ErrorInfo");}
var retval=this.swap();retval.setType("error");var builder=new jabberwerx.NodeBuilder(retval.getNode()).xml(err.getNode().xml);return retval;},willBeSerialized:function(){this.timestamp=this.timestamp.getTime();this._serializedXML=this._DOM.xml;delete this._DOM;},wasUnserialized:function(){if(this._serializedXML&&this._serializedXML.length){this._DOM=jabberwerx.util.unserializeXML(this._serializedXML);delete this._serializedXML;}
this.timestamp=this.timestamp?new Date(this.timestamp):new Date();},timestamp:null,_DOM:null},"jabberwerx.Stanza");jabberwerx.Stanza.generateID=function(){return jabberwerx.util.crypto.b64_sha1(jabberwerx.util.crypto.generateUUID());};jabberwerx.Stanza.ErrorInfo=jabberwerx.JWModel.extend({init:function(type,cond,text){this._super();this.type=type||"wait";this.condition=cond||"{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error";this.text=text||"";this.toString=this._toErrString;},getNode:function(){var builder=new jabberwerx.NodeBuilder("error");builder.attribute("type",this.type);builder.element(this.condition);if(this.text){builder.element("{urn:ietf:params:xml:ns:xmpp-stanzas}text").text(this.text);}
return builder.data;},wasUnserialized:function(){this.toString=this._toErrString;},_toErrString:function(){return this.condition;},type:"",condition:"",text:""},"jabberwerx.Stanza.ErrorInfo");jabberwerx.Stanza.ErrorInfo.createWithNode=function(node){if(!jabberwerx.isElement(node)){throw new TypeError("node must be an Element");}
node=jabberwerx.$(node);var type=node.attr("type");var cond=node.children("[xmlns='urn:ietf:params:xml:ns:xmpp-stanzas']:not(text)").map(function(){return"{urn:ietf:params:xml:ns:xmpp-stanzas}"+this.nodeName;}).get(0);var text=node.children("text[xmlns='urn:ietf:params:xml:ns:xmpp-stanzas']").text();return new jabberwerx.Stanza.ErrorInfo(type,cond,text);};jabberwerx.Stanza.ERR_BAD_REQUEST=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}bad-request");jabberwerx.Stanza.ERR_CONFLICT=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}conflict");jabberwerx.Stanza.ERR_FEATURE_NOT_IMPLEMENTED=new jabberwerx.Stanza.ErrorInfo("cancel","{urn:ietf:params:xml:ns:xmpp-stanzas}feature-not-implemented");jabberwerx.Stanza.ERR_FORBIDDEN=new jabberwerx.Stanza.ErrorInfo("auth","{urn:ietf:params:xml:ns:xmpp-stanzas}forbidden");jabberwerx.Stanza.ERR_INTERNAL_SERVER_ERROR=new jabberwerx.Stanza.ErrorInfo("wait","{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error");jabberwerx.Stanza.ERR_ITEM_NOT_FOUND=new jabberwerx.Stanza.ErrorInfo("cancel","{urn:ietf:params:xml:ns:xmpp-stanzas}item-not-found");jabberwerx.Stanza.ERR_JID_MALFORMED=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}jid-malformed");jabberwerx.Stanza.ERR_NOT_ACCEPTABLE=new jabberwerx.Stanza.ErrorInfo("modify","{urn:ietf:params:xml:ns:xmpp-stanzas}not-acceptable");jabberwerx.Stanza.ERR_NOT_ALLOWED=new jabberwerx.Stanza.ErrorInfo("cancel","{urn:ietf:params:xml:ns:xmpp-stanzas}not-allowed");jabberwerx.Stanza.ERR_NOT_AUTHORIZED=new jabberwerx.Stanza.ErrorInfo("auth","{urn:ietf:params:xml:ns:xmpp-stanzas}not-authorized");jabberwerx.Stanza.ERR_SERVICE_UNAVAILABLE=new jabberwerx.Stanza.ErrorInfo("wait","{urn:ietf:params:xml:ns:xmpp-stanzas}service-unavailable");jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT=new jabberwerx.Stanza.ErrorInfo("wait","{urn:ietf:params:xml:ns:xmpp-stanzas}remote-server-timeout");jabberwerx.Stanza.createWithNode=function(node){if(!jabberwerx.isElement(node)){throw new TypeError("node must be an element");}
var stanza;switch(node.nodeName){case"iq":stanza=new jabberwerx.IQ(node);break;case"message":stanza=new jabberwerx.Message(node);break;case"presence":stanza=new jabberwerx.Presence(node);break;default:stanza=new jabberwerx.Stanza(node);break;}
return stanza;};jabberwerx.IQ=jabberwerx.Stanza.extend({init:function(packet){if(packet){if(!jabberwerx.isElement(packet)){throw new TypeError("packet must be an &lt;iq/&gt; Element");}
if(packet.nodeName!="iq"){throw new TypeError("packet must be an &lt;iq/&gt; Element");}}
this._super(packet||"{jabber:client}iq");},getQuery:function(){return jabberwerx.$(this.getNode()).children(":not(error)").get(0);},setQuery:function(payload){if(payload&&!jabberwerx.isElement(payload)){throw new TypeError("Node must be an element");}
var q=jabberwerx.$(this.getNode()).children(":not(error)");q.remove();if(payload){new jabberwerx.NodeBuilder(this.getNode()).node(payload);}},reply:function(payload){var retval=this.swap();try{jabberwerx.$(retval.getNode()).empty();}catch(ex){var n=retval.getNode();for(var idx=0;idx<n.childNodes.length;idx++){n.removeChild(n.childNodes[idx]);}}
if(payload){var builder=new jabberwerx.NodeBuilder(retval.getNode());if(jabberwerx.isElement(payload)){builder.node(payload);}else if(typeof(payload)=="string"){builder.xml(payload);}else{throw new TypeError("payload must be an Element or XML representation of an Element");}}
retval.setType("result");return retval;}},"jabberwerx.IQ");jabberwerx.Message=jabberwerx.Stanza.extend({init:function(packet){if(packet){if(!jabberwerx.isElement(packet)){throw new TypeError("Must be a <message/> element");}
if(packet.nodeName!="message"){throw new TypeError("Must be a <message/> element");}}
this._super(packet||"{jabber:client}message");},getBody:function(){return this._getChildText("body");},setBody:function(body){this.setHTML();this._setChildText("body",body||undefined);},getHTML:function(){var ret=jabberwerx.$(this.getNode()).find("html[xmlns='http://jabber.org/protocol/xhtml-im']>body[xmlns='http://www.w3.org/1999/xhtml']:first");if(ret.length&&!this._isSanitized){this.setHTML(ret.children().get());return this.getHTML();}
return ret.length?ret.get(0):null;},setHTML:function(html){var htmlNode;if(html&&!jabberwerx.util.isString(html)&&!jabberwerx.isElement(html)&&(!jabberwerx.$.isArray(html)||!html.length)){throw new TypeError("html must be a string, DOM or an array");}
this._isSanitized=false;var htmlNode=jabberwerx.$(this.getNode()).find("html[xmlns='http://jabber.org/protocol/xhtml-im']");if(htmlNode){htmlNode.remove();}
this._setChildText("body",null);if(html){htmlNode=html;if(jabberwerx.util.isString(html)){try{htmlNode=jabberwerx.util.unserializeXML(html);}catch(ex){jabberwerx.util.debug.log("setHTML could not parse: '"+html+"'");throw ex;}}
if(jabberwerx.$.isArray(html)||htmlNode.nodeName!="body")
{var newBodyBuilder=new jabberwerx.NodeBuilder("{http://www.w3.org/1999/xhtml}body");if(jabberwerx.$.isArray(html)){jabberwerx.$.each(html,function(index,item){newBodyBuilder.node(item);});}else if(jabberwerx.util.isString(html)){newBodyBuilder.xml(html);}else{newBodyBuilder.node(html);}
html=newBodyBuilder.data;}
jabberwerx.xhtmlim.sanitize(html);html=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/xhtml-im}html").node(html).parent.data;this._setChildText("body",jabberwerx.$(html).text());jabberwerx.$(this.getNode()).append(html);this._isSanitized=true;}},getSubject:function(){return this._getChildText("subject");},setSubject:function(subject){this._setChildText("subject",subject||undefined);},getThread:function(){return this._getChildText("thread")||null;},setThread:function(thread){this._setChildText("thread",thread||undefined);},_isSanitized:false},"jabberwerx.Message");jabberwerx.Message.translate=function(content,displayName){var xep0245Found=false;var textNodeFound=false;var translatedContent=null;var findTextNodes=function(element,displayName){if(!xep0245Found&&!textNodeFound){if(jabberwerx.isText(element)){var replace=translateSlashMe(jabberwerx.$(element).text(),displayName);if(xep0245Found){jabberwerx.$(element).replaceWith(replace);}else{textNodeFound=true;}}else if(element.hasChildNodes()){for(var i=0;i<element.childNodes.length;i++){findTextNodes(element.childNodes[i],displayName);}}}};var translateSlashMe=function(rawText,displayName){var slashMe="/me ";if(rawText.substring(0,slashMe.length).toLowerCase()==slashMe){xep0245Found=true;return("* "+displayName+" "+rawText.substring(slashMe.length));}
return rawText;};if(typeof content=="string"){content=translateSlashMe(content,displayName);}else if(jabberwerx.isElement(content)){for(var i=0;i<content.childNodes.length;i++){if(!xep0245Found&&!textNodeFound){findTextNodes(content.childNodes[i],displayName);}else{break;}}}else{throw new jabberwerx.Message.InvalidContentFormat();}
if(xep0245Found){translatedContent=content;}
return translatedContent;};jabberwerx.Message.InvalidContentFormat=jabberwerx.util.Error.extend('The content parameter must be of type string or a jQuery object.');jabberwerx.Presence=jabberwerx.Stanza.extend({init:function(packet){if(packet){if(!jabberwerx.isElement(packet)){throw new TypeError("packet must be a &lt;presence/&gt; Element");}
if(packet.nodeName!="presence"){throw new TypeError("packet must be a &lt;presence/&gt; Element");}}
this._super(packet||"{jabber:client}presence");},getPriority:function(){var pri=this._getChildText("priority");pri=(pri)?parseInt(pri):0;return!isNaN(pri)?pri:0;},setPriority:function(pri){if(pri!==undefined&&pri!==null&&typeof(pri)!="number"){throw new TypeError("new priority must be a number or undefined");}
this._setChildText("priority",pri);},getShow:function(){return this._getChildText("show")||jabberwerx.Presence.SHOW_NORMAL;},setShow:function(show){if(show&&(show!=jabberwerx.Presence.SHOW_AWAY&&show!=jabberwerx.Presence.SHOW_CHAT&&show!=jabberwerx.Presence.SHOW_DND&&show!=jabberwerx.Presence.SHOW_XA)){throw new TypeError("show must be undefined or one of 'away', 'chat', 'dnd', or 'xa'");}
this._setChildText("show",show||undefined);},getStatus:function(){return this._getChildText("status")||null;},setStatus:function(status){this._setChildText("status",status||undefined);},compareTo:function(presence){if(!(presence&&presence instanceof jabberwerx.Presence)){throw new TypeError("presence must be an instanceof jabberwerx.Presence");}
var p1,p2;p1=this.getPriority()||0;p2=presence.getPriority()||0;if(p1>p2){return 1;}else if(p1<p2){return-1;}
p1=this.timestamp;p2=presence.timestamp;if(p1>p2){return 1;}else if(p1<p2){return-1;}
return 0;},setPresence:function(show,status,priority){if(show){this.setShow(show);}
if(status){this.setStatus(status);}
if(priority!==undefined&&priority!==null){this.setPriority(priority);}
return this;}},"jabberwerx.Presence");jabberwerx.Presence.SHOW_AWAY="away";jabberwerx.Presence.SHOW_CHAT="chat";jabberwerx.Presence.SHOW_DND="dnd";jabberwerx.Presence.SHOW_NORMAL="";jabberwerx.Presence.SHOW_XA="xa";})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/User.js*/
;(function(jabberwerx){jabberwerx.User=jabberwerx.Entity.extend({init:function(jid,cache){this._super({jid:jid},cache);}},'jabberwerx.User');jabberwerx.LocalUser=jabberwerx.User.extend({getDisplayName:function(){return this._displayName||jabberwerx.JID.unescapeNode(this.jid.getNode());}},'jabberwerx.LocalUser');})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Server.js*/
;(function(jabberwerx){jabberwerx.Server=jabberwerx.Entity.extend({init:function(serverDomain,cache){this._super({jid:serverDomain},cache);}},'jabberwerx.Server');})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Stream.js*/
;(function(jabberwerx){jabberwerx.Stream=jabberwerx.JWModel.extend({init:function(){this.applyEvent("streamOpened");this.applyEvent("streamClosed");this.applyEvent("streamElementsReceived");this.applyEvent("streamElementsSent");this._recvQ=new jabberwerx.Stream.Queue();this._sendQ=new jabberwerx.Stream.Queue();this._xhrs=new jabberwerx.Stream.Queue();this._xhrSetup={cache:false,xhr:this.invocation("_createXHR",jabberwerx.$.ajaxSettings.xhr),beforeSend:this.invocation("_prepareXHR"),complete:this.invocation("_handleXHR"),contentType:"text/xml",dataType:"text",global:false,processData:false,type:"POST"};},getProperties:function(){return jabberwerx.$.extend(true,{},this._boshProps);},isOpen:function(){return this._opened;},isSecure:function(){return this._boshProps.secure||false;},getDomain:function(){return this._boshProps.domain||null;},getSessionID:function(){return this._boshProps.sid||null;},getTimeout:function(){return this._boshProps.timeout||60;},open:function(params){if(this.isOpen()){throw new jabberwerx.Stream.AlreadyOpenError();}
this._reset();this._boshProps=jabberwerx.$.extend({},params||{});if(!this._boshProps.domain){throw new TypeError("domain must be specified");}
if(!this._boshProps.timeout){this._boshProps.timeout=jabberwerx.Stream.DEFAULT_TIMEOUT;}
if(!this._boshProps.wait){this._boshProps.wait=jabberwerx.Stream.DEFAULT_WAIT;}
var url=jabberwerx.Stream.URL_PARSER.exec(this._boshProps.httpBindingURL||"");if(!url){throw new TypeError("httpBindingURL not specified correctly");}
var myProto=jabberwerx.system.getLocation().protocol;if(!url[1]){url[1]=myProto||"";}else if(myProto&&url[1]!=myProto){jabberwerx.util.debug.warn("BOSH URL has different protocol than webserver: "+url[1]+" != "+myProto);}
if(!url[2]){url[2]=jabberwerx.system.getLocation().host||"";}
if(!url[3]){url[3]="";}
this._boshProps.networkAttempts=0;this._storeConnectionInfo(url[1],url[2],url[3]);this._boshProps.operation="open";this._sendRequest();this._boshProps.heartbeat=jabberwerx.system.setInterval(this.invocation("_heartbeat"),jabberwerx.Stream.HEARTBEAT_INTERVAL);},_storeConnectionInfo:function(protocol,hostPort,resource){this._boshProps.httpBindingURL=protocol+"//"+
hostPort+"/"+
resource;this._boshProps.secure=this._boshProps.secure||(protocol=="https:");this._boshProps.crossSite=(jabberwerx.system.getLocation().protocol!=protocol)||(jabberwerx.system.getLocation().host!=hostPort);},reopen:function(){if(!this.isOpen()){throw new jabberwerx.Stream.NotOpenError();}
this._boshProps.opening=jabberwerx.system.setTimeout(this.invocation("_handleOpen"),2000);this._boshProps.operation="reopen";this._sendRequest({restart:true});},close:function(){if(this.isOpen()&&this._boshProps&&!this._boshProps.networkBackoff){delete this._boshProps.resend;delete this._boshProps.networkBackoff;this._boshProps.networkAttempts=0;this._sendRequest({type:"terminate"},this._sendQ.empty());}else{this._reset();}},send:function(elem){if(!jabberwerx.isElement(elem)){throw new TypeError("elem must be a DOM element");}
if(!this.isOpen()){throw new jabberwerx.Stream.NotOpenError();}
this._sendQ.enque(elem);},_sendRequest:function(props,data){props=jabberwerx.$.extend({},this._boshProps,props);data=data||[];var rid=0,body;var resend=false;if(props.resend){try{body=jabberwerx.util.unserializeXML(props.resend.body);resend=true;}catch(ex){jabberwerx.util.debug.log("Exception: "+ex.message+" trying to parse resend body: "+props.resend.body);delete props.resend;return;}
rid=props.resend.id;data=jabberwerx.$(body).children();props.rid=rid+1;delete props.resend;}else{if(this._xhrs.size()>1&&data.length){this._sendQ.enque(data);return;}
if(!props.rid){var initial;initial=Math.floor(Math.random()*4294967296);initial=(initial<=32768)?initial+32768:initial;props.rid=initial;}else if(this._boshProps.rid>=9007199254740991){var err=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}policy-violation","BOSH maximum rid exceeded");this._handleClose(err.getNode());return;}
rid=props.rid++;body=new jabberwerx.NodeBuilder("{http://jabber.org/protocol/httpbind}body");if(props.type){body.attribute("type",props.type);}
locale=jabberwerx.system.getLocale();if(!props.sid){if(data.length){this._sendQ.enque(data);data=[];}
if(locale){body.attribute("xml:lang",locale);}
body.attribute("xmlns:xmpp","urn:xmpp:xbosh").attribute("hold","1").attribute("ver","1.9").attribute("to",props.domain).attribute("wait",props.wait||30).attribute("{urn:xmpp:xbosh}xmpp:version","1.0");if(props.jid){body.attribute("from",jabberwerx.JID.asJID(props.jid).getBareJIDString());}}else{body.attribute("sid",props.sid);if(props.restart){if(locale){body.attribute("xml:lang",locale);}
body.attribute("{urn:xmpp:xbosh}xmpp:restart","true").attribute("to",props.domain);this._boshProps.restart=true;}}
body.attribute("rid",rid);if(data.length){for(var idx=0;idx<data.length;idx++){body.node(data[idx]);}}
body=body.data;}
if(!props.requests){props.requests=new jabberwerx.Stream.Queue();}
props.requests.enque({id:rid,body:jabberwerx.util.serializeXML(body)});var setup={async:true,data:props.requests.tail().body,timeout:props.wait*1000+5000,url:props.httpBindingURL};setup=jabberwerx.$.extend(setup,this._xhrSetup);if(this._boshProps.crossSite&&!jabberwerx.$.support.cors&&typeof(XDomainRequest)!="undefined"){setup.crossDomain=false;}
if(this._boshProps){this._boshProps=props;}
if(!resend&&data.length){this.event("streamElementsSent").trigger(jabberwerx.$(data));}
var xhr=jabberwerx.$.ajax(setup);},_createXHR:function(xhrFn){xhrFn=jabberwerx.$.ajaxSettings.xhr;var xhr=null;if(this._boshProps.crossSite&&!jabberwerx.$.support.cors&&typeof(XDomainRequest)!=="undefined"){var that=this;var done=this._boshProps.type=="terminate";var xdr=new XDomainRequest();var xhr={readyState:0,abort:function(){xdr.abort();this.readyState=0;},open:function(){xdr.open.apply(xdr,arguments);this.readyState=1;this.onreadystatechange&&this.onreadystatechange.call(this);this.async=arguments[2]||true;},send:function(){this.readyState=2;this.onreadystatechange&&this.onreadystatechange.call(this);xdr.send.apply(xdr,arguments);},setRequestHeader:function(){},getResponseHeader:function(){},getAllResponseHeaders:function(){}};var onreadyCB=function(status){xhr.onreadystatechange&&xhr.onreadystatechange.call(this,status);};xdr.onload=function(){xhr.responseText=xdr.responseText;xhr.status=200;xhr.readyState=4;onreadyCB();};xdr.onprogress=function(){xhr.readyState=3;onreadyCB();};xdr.onerror=function(){xhr.readyState=4;xhr.status=500;onreadyCB("error");};xdr.ontimeout=function(){xhr.readyState=4;xhr.status=408;onreadyCB("timeout");};}else{xhr=xhrFn();}
return xhr;},_heartbeat:function(){var elems=this._recvQ.empty();if(elems.length){elems=jabberwerx.$(elems);this.event("streamElementsReceived").trigger(elems);}
if(this._boshProps.networkBackoff){this._boshProps.networkBackoff--;return;}
if(!this.isOpen()&&!this._boshProps.operation){return;}
if(!this._sendQ.size()&&this._xhrs.size()&&!this._boshProps.resend){return;}
this._sendRequest({},this._sendQ.empty());},_prepareXHR:function(xhr,settings){this._xhrs.enque(xhr);},_handleXHR:function(xhr,status){if(this._dehydrated||!this._xhrs||(this._xhrs.size()===0)){return;}
this._xhrs.deque(xhr);var failFn=function(err,resend){var boshProps=this._boshProps;if(!boshProps){return;}
if(boshProps.type=="terminate"){this._handleClose();return;}
if(boshProps.networkAttempts++<3){jabberwerx.util.debug.log("network timeout retry "+
boshProps.networkAttempts);if(resend){resend=boshProps.requests.pop();}
if(resend){boshProps.resend=resend;}
boshProps.networkBackoff=jabberwerx.Stream.NETWORK_BACKOFF_COUNT*Math.pow(boshProps.networkAttempts,2);return;}
this._handleClose(err&&err.getNode());};if(status!="success"){var err;switch(status){case"timeout":err=jabberwerx.Stream.ERR_REMOTE_SERVER_TIMEOUT;break;case"error":err=jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE;break;case"parseerror":err=jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED;break;default:err=jabberwerx.Stream.ERR_UNDEFINED_CONDITION;break;}
failFn.call(this,err,true);return;}
var dom=xhr.responseText;if(!dom){failFn.call(this,jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED);return;}
try{dom=jabberwerx.util.unserializeXML(dom);}catch(ex){failFn.call(this,jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED);return;}
if(!dom){failFn.call(this,jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED);return;}
dom=jabberwerx.$(dom);if(!dom.is("body[xmlns='http://jabber.org/protocol/httpbind']")){failFn.call(this,jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE);return;}
this._boshProps.networkAttempts=0;if(this._boshProps&&this._boshProps.requests){this._boshProps.requests.deque();}
var content=dom.children();if(!this._boshProps.sid){var attr;attr=dom.attr("sid");if(attr){this._boshProps.sid=attr;}
attr=dom.attr("wait");if(attr){this._boshProps.wait=parseInt(attr);}
attr=dom.attr("inactivity");if(attr){this._boshProps.timeout=parseInt(attr);}}
if(content.length){var feats=null,err=null;content=content.map(function(){switch(this.nodeName){case"stream:features":feats=this;break;case"stream:error":err=this;break;default:return this;}
return null;});if(feats){this._handleOpen(feats);}
if(content.length){this._recvQ.enque(content.get());}
if(err){this._handleClose(err);return;}}
var err;switch(dom.attr("type")||this._boshProps.type){case"terminate":if(!this._boshProps.type){switch(dom.attr("condition")||""){case"":err=null;break;case"bad-request":err=jabberwerx.Stream.ERR_BAD_REQUEST;break;case"host-gone":err=jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE;break;case"other-request":err=jabberwerx.Stream.ERR_CONFLICT;break;case"policy-violation":err=jabberwerx.Stream.ERR_POLICY_VIOLATION;break;case"system-shutdown":err=jabberwerx.Stream.ERR_SYSTEM_SHUTDOWN;break;case"see-other-uri":var uri=dom.children("uri").text();if(!uri||uri=="")
{err=jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED;break;}
var uriParts=jabberwerx.Stream.URL_PARSER.exec(uri);var protocol=uriParts[1];var hostPort=uriParts[2];var resource=uriParts[3];var origParts=jabberwerx.Stream.URL_PARSER.exec(this._boshProps.httpBindingURL);var origProtocol=origParts[1];var origHostPort=origParts[2];if(origProtocol=="http:"){var tmpOrigHostPort="."+origHostPort;var tmpHostPort="."+hostPort;var diff=tmpHostPort.length-tmpOrigHostPort.length;var validDomain=diff>=0&&tmpHostPort.lastIndexOf(tmpOrigHostPort)===diff;if(!((protocol==origProtocol)&&(validDomain))){err=jabberwerx.Stream.ERR_POLICY_VIOLATION;break;}}else if(origProtocol=="https:"){if((!protocol||protocol=="")||(!hostPort||hostPort=="")){err=jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED;break;}}else{err=jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED;break;}
this._storeConnectionInfo(protocol,hostPort,resource);return;default:err=jabberwerx.Stream.ERR_UNDEFINED_CONDITION;break;}}
this._handleClose(err&&err.getNode());return;case"error":break;}},_handleOpen:function(feats){if(this._boshProps.opening){jabberwerx.system.clearTimeout(this._boshProps.opening);delete this._boshProps.opening;}
delete this._boshProps.restart;delete this._boshProps.operation;if(!jabberwerx.isElement(feats)){feats=new jabberwerx.NodeBuilder("{http://etherx.jabber.org/streams}stream:features");feats.element("{urn:ietf:params:xml:ns:xmpp-bind}bind");feats.element("{urn:ietf:params:xml:ns:xmpp-session}session");feats=feats.data;}
var that=this;jabberwerx.system.setTimeout(function(){that._opened=true;that.event("streamOpened").trigger(feats);},1);},_handleClose:function(err){var open=this.isOpen();var oper=this._boshProps.operation;this._reset();if(open||oper){var that=this;jabberwerx.system.setTimeout(function(){that.event("streamClosed").trigger(err);},10);}},_reset:function(){jabberwerx.system.clearInterval(this._boshProps.heartbeat);this._opened=false;this._boshProps={};this._sendQ.empty();this._xhrs.empty();this._recvQ.empty();},willBeSerialized:function(){this._dehydrated=true;if(this.isOpen()){jabberwerx.system.clearInterval(this._boshProps.heartbeat);}
if(this._boshProps){if(this._boshProps.networkAttempts){this._boshProps.networkAttempts--;}
this._boshProps.networkBackoff=jabberwerx.Stream.NETWORK_BACKOFF_COUNT;}
var elems;elems=this._sendQ.empty();elems=jabberwerx.$.map(elems,function(){return jabberwerx.util.serializeXML(this);});this._sendQ.enque(elems);elems=this._recvQ.empty();elems=jabberwerx.$.map(elems,function(){return jabberwerx.util.serializeXML(this);});this._recvQ.empty();delete this._xhrs;},wasUnserialized:function(){this._xhrs=new jabberwerx.Stream.Queue();var elems;elems=this._sendQ.empty();elems=jabberwerx.$.map(elems,function(){return jabberwerx.util.unserializeXML(String(this));});this._sendQ.enque(elems);delete this._dehydrated;if(this.isOpen()){this._boshProps.resend=this._boshProps.requests.deque();this._boshProps.heartbeat=jabberwerx.system.setInterval(this.invocation("_heartbeat"),jabberwerx.Stream.HEARTBEAT_INTERVAL);}},_opened:false,_boshProps:{},_xhrSetup:{},_xhrs:null,_sendQ:null,_recvQ:null},"jabberwerx.Stream");jabberwerx.Stream.Queue=jabberwerx.JWModel.extend({init:function(){this._super();},head:function(){return this._q||null;},tail:function(){return this._q[this._q.length-1]||null;},enque:function(item){for(var idx=0;idx<arguments.length;idx++){item=arguments[idx];var tmp=[this._q.length,0].concat(item);this._q.splice.apply(this._q,tmp);}
return this.size();},deque:function(item){if(item!==undefined){var idx=jabberwerx.$.inArray(item,this._q);if(idx!=-1){this._q.splice(idx,1);}else{item=null;}}else{item=this._q.shift()||null;}
return item;},pop:function(){return this._q.pop()||null;},find:function(cmp){if(!jabberwerx.$.isFunction(cmp)){throw new TypeError("comparator must be a function");}
var result=null;jabberwerx.$.each(this._q,function(){result=cmp(this);return(result!==undefined);});return result;},empty:function(){var q=this._q;this._q=[];return q;},size:function(){return this._q.length;},_q:[]},"jabberwerx.Stream.Queue");jabberwerx.Stream.URL_PARSER=/^(?:([0-9a-zA-Z]+\:)\/\/)?(?:([^\/]+))?(?:\/(.*))?$/;jabberwerx.Stream.DEFAULT_TIMEOUT=300;jabberwerx.Stream.DEFAULT_WAIT=30;jabberwerx.Stream.HEARTBEAT_INTERVAL=10;jabberwerx.Stream.NETWORK_BACKOFF_COUNT=50;jabberwerx.Stream.NotOpenError=jabberwerx.util.Error.extend("Stream not open");jabberwerx.Stream.AlreadyOpenError=jabberwerx.util.Error.extend("Stream is already open");jabberwerx.Stream.ErrorInfo=jabberwerx.JWModel.extend({init:function(cond,text){this._super();this.condition=cond||"{urn:ietf:params:xml:ns:xmpp-streams}undefined-condition";this.text=text||"";this.toString=this._toErrString;},getNode:function(){var builder=new jabberwerx.NodeBuilder("{http://etherx.jabber.org/streams}stream:error");builder.element(this.condition);if(this.text){builder.element("{urn:ietf:params:xml:ns:xmpp-streams}text").text(this.text);}
return builder.data;},wasUnserialized:function(){this.toString=this._toErrString;},_toErrString:function(){return this.condition;},condition:"",text:""},"jabberwerx.Stream.ErrorInfo");jabberwerx.Stream.ErrorInfo.createWithNode=function(node){if(!jabberwerx.isElement(node)){throw new TypeError("node must be an Element");}
node=jabberwerx.$(node);var cond=node.children("[xmlns='urn:ietf:params:xml:ns:xmpp-streams']:not(text)").map(function(){return"{urn:ietf:params:xml:ns:xmpp-streams}"+this.nodeName;}).get(0);var text=node.children("text[xmlns='urn:ietf:params:xml:ns:xmpp-streams']").text();return new jabberwerx.Stream.ErrorInfo(cond,text);};jabberwerx.Stream.ERR_BAD_REQUEST=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}bad-request");jabberwerx.Stream.ERR_CONFLICT=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}conflict");jabberwerx.Stream.ERR_POLICY_VIOLATION=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}policy-violation");jabberwerx.Stream.ERR_REMOTE_CONNECTION_FAILED=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}remote-connection-failed");jabberwerx.Stream.ERR_REMOTE_SERVER_TIMEOUT=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}remote-server-timeout");jabberwerx.Stream.ERR_SERVICE_UNAVAILABLE=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}service-unavailable");jabberwerx.Stream.ERR_SYSTEM_SHUTDOWN=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}system-shutdown");jabberwerx.Stream.ERR_UNDEFINED_CONDITION=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}undefined-condition");jabberwerx.Stream.ERR_XML_NOT_WELL_FORMED=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}xml-not-well-formed");jabberwerx.Stream.ERR_POLICY_VIOLATION=new jabberwerx.Stream.ErrorInfo("{urn:ietf:params:xml:ns:xmpp-streams}policy-violation");})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/model/Client.js*/
;(function(jabberwerx){jabberwerx.ClientEntityCache=jabberwerx.EntitySet.extend({init:function(){this._super();},register:function(entity){if(!(entity&&entity instanceof jabberwerx.Entity)){throw new TypeError("entity is not an Entity");}
var prev=this.entity(entity.jid,entity.node);if(prev&&prev!==entity){throw new jabberwerx.EntitySet.EntityAlreadyExistsError();}else if(!prev){this.event("entityCreated").trigger(entity);}
return this._super(entity);},unregister:function(entity){var result=this._super(entity);if(result){this.event("entityDestroyed").trigger(entity);}
return result;},localUser:function(jid){var ent=this.entity(jid);if(!(ent&&ent instanceof jabberwerx.LocalUser)){ent=new jabberwerx.LocalUser(jid,this);this.register(ent);}
return ent;},server:function(serverDomain){var ent=this.entity(serverDomain);if(!ent||!(ent instanceof jabberwerx.Server)){ent=new jabberwerx.Server(serverDomain,this);this.register(ent);}
return ent;},temporaryEntity:function(jid){var ent=this.entity(jid);if(!(ent&&ent instanceof jabberwerx.TemporaryEntity)){ent=new jabberwerx.TemporaryEntity(jid,this);this.register(ent);}
return ent;}},"jabberwerx.ClientEntityCache");jabberwerx.Client=jabberwerx.JWModel.extend({init:function(resourceName){this._super();this.applyEvent('clientStatusChanged');this.applyEvent('beforeIqSent');this.applyEvent('iqSent');this.applyEvent('beforeIqReceived');this.applyEvent('iqReceived');this.applyEvent('afterIqReceived');this.applyEvent('beforeMessageSent');this.applyEvent('messageSent');this.applyEvent('beforeMessageReceived');this.applyEvent('messageReceived');this.applyEvent('afterMessageReceived');this.applyEvent('beforePresenceSent');this.applyEvent('presenceSent');this.applyEvent('beforePresenceReceived');this.applyEvent('presenceReceived');this.applyEvent('afterPresenceReceived');this.applyEvent('reconnectCountdownStarted');this.applyEvent('reconnectCancelled');this.applyEvent('clientConnected');this.applyEvent('clientDisconnected');this.entitySet=new jabberwerx.ClientEntityCache();if(resourceName&&typeof resourceName=='string'){this.resourceName=resourceName;}
else{this._autoResourceName=true;}
this._stream=new jabberwerx.Stream();this.event('afterIqReceived').bindWhen('iq[type="get"] *[xmlns="urn:xmpp:time"]',this.invocation('_handleEntityTime'));this.event('afterIqReceived').bindWhen('iq[type="get"] *[xmlns="jabber:iq:time"]',this.invocation('_handleIqTime'));this.event('presenceReceived').bind(this.invocation('_handlePresenceIn'));},destroy:function(){jabberwerx.$.each(this.controllers,function(){this.destroy();});this._super();},_setStreamHandler:function(evt,funcName){this._clearStreamHandler(evt);this._streamHandlers[evt]=funcName;this._stream.event(evt).bind(this.invocation(this._streamHandlers[evt]));},_clearStreamHandler:function(evt){if(this._streamHandlers[evt]!==undefined){this._stream.event(evt).unbind(this.invocation(this._streamHandlers[evt]));delete this._streamHandlers[evt];}},_clearStreamHandlers:function(){this._clearStreamHandler('streamOpened');this._clearStreamHandler('streamClosed');this._clearStreamHandler('streamElementsReceived');this._clearStreamHandler('streamElementsSent');this._streamHandlers={};},_newConnectParams:function(cjid,password,arg){cjid=jabberwerx.JID.asJID(cjid);return{jid:cjid,password:password,username:cjid.getNode(),domain:cjid.getDomain(),resource:this.resourceName,httpBindingURL:arg.httpBindingURL||jabberwerx._config.httpBindingURL,secure:arg.unsecureAllowed||jabberwerx._config.unsecureAllowed||false,timeout:arg.timeout||null,wait:arg.wait||null,arg:arg};},connect:function(jid,password,arg){var __createEntities=function(client){var user;jabberwerx.$.each(client.entitySet.toArray(),function(){if(this instanceof jabberwerx.LocalUser){if(client._connectParams.jid.equals(this.jid)){user=this;}else{this.remove();}}});client.connectedUser=user||client.entitySet.localUser(client._connectParams.jid);client._setFullJid();var server;jabberwerx.$.each(client.entitySet.toArray(),function(){if(this instanceof jabberwerx.Server){if(client._connectParams.jid.getDomain()==this.jid.getDomain()){server=this;}else{this.remove();}}});client.connectedServer=server||client.entitySet.server(client._connectParams.jid.getDomain());}
var __bindCallbacks=function(client){var successCB=client._connectParams.arg.successCallback;var errorCB=client._connectParams.arg.errorCallback;if(successCB||errorCB){var fn=function(evt){var evtCon=(evt.data.next==jabberwerx.Client.status_connected);var evtDiscon=(evt.data.next==jabberwerx.Client.status_disconnected);if(evtCon||evtDiscon){client.event('clientStatusChanged').unbind(fn);if(successCB&&evtCon){successCB(client);}else if(errorCB&&evt.data.error&&evtDiscon){errorCB(evt.data.error);}}};client.event('clientStatusChanged').bind(fn);}}
if(this.clientStatus!=jabberwerx.Client.status_disconnected){jabberwerx.util.debug.log("client not disconnected!");return;}
if(!arg){arg={};}
this.cancelReconnect();this._clearStreamHandlers();this._stream.close();try{var cjid=jabberwerx.JID.asJID(jid);if(!cjid.getNode()){arg.register=true;cjid=new jabberwerx.JID({domain:cjid.getDomain(),node:"CAXL_"+jabberwerx.util.crypto.generateUUID()});if(!password){password=jabberwerx.util.crypto.b64_sha1(jabberwerx.util.crypto.generateUUID());}}
this._connectParams=this._newConnectParams(cjid,password,arg);this._openStream();__createEntities(this);__bindCallbacks(this);if(this._connectParams.arg.reconnecting){this.setClientStatus(jabberwerx.Client.status_reconnecting);this._connectParams.arg.reconnecting=false;}else{this.setClientStatus(jabberwerx.Client.status_connecting);}
this._connectionAttempts++;}catch(ex){this._connectParams={};throw new jabberwerx.Client.ConnectionError(ex.message||'invalid connection information');}},_filterStreamOpts:function(cparams){cparams=cparams||{};return{jid:cparams.jid,domain:cparams.domain,timeout:cparams.timeout,wait:cparams.wait,secure:cparams.secure,httpBindingURL:cparams.httpBindingURL};},_openStream:function(){if(this._connectParams.arg.register){this._setStreamHandler('streamOpened','_handleRegistrationOpened');}else{this._setStreamHandler('streamOpened','_handleAuthOpened');}
this._setStreamHandler('streamClosed','_handleClosed');var streamOpts=this._filterStreamOpts(this._connectParams);try{this._stream.open(streamOpts);}catch(ex){this._clearStreamHandlers();throw ex;}},_handleRegistrationOpened:function(){try{this._clearStreamHandler('streamOpened');var registerIQ=new jabberwerx.IQ();registerIQ.setType("set");registerIQ.setID(jabberwerx.Stanza.generateID());var builder=new jabberwerx.NodeBuilder('{jabber:iq:register}query');builder=builder.element("username").text(this._connectParams.username).parent;builder=builder.element("password").text(this._connectParams.password).parent;registerIQ.setQuery(builder.data);this._setStreamHandler('streamElementsReceived','_handleRegisterElements');this._stream.send(registerIQ.getNode());}catch(ex){this._handleConnectionException(ex);}},_handleRegisterElements:function(elem){try{this._clearStreamHandler('streamElementsReceived');var errNode=jabberwerx.$(elem.data).find("error");if(errNode&&errNode.length!=0){this._connectParams.arg.register=false;this._handleConnectionException(errNode);}
else{this._stream.close();}}catch(ex){this._handleConnectionException(ex);}},_handleAuthOpened:function(feats){try{this._clearStreamHandler('streamOpened');this._connectParams.feats=jabberwerx.$(feats.data);var supportedMechs=[]
jabberwerx.$(feats.data).find("mechanisms[xmlns='urn:ietf:params:xml:ns:xmpp-sasl']>mechanism").each(function(){supportedMechs.push(jabberwerx.$(this).text().toUpperCase());});this._authMech=jabberwerx.sasl.createMechanismFor(this,supportedMechs);if(!this._authMech){throw new jabberwerx.Client.ConnectionError("{urn:ietf:params:xml:ns:xmpp-sasl}mechanism-too-weak");}
this._setStreamHandler('streamElementsReceived','_handleAuthElements');this._handleAuthElements();}catch(ex){this._handleConnectionException(ex);}},_handleAuthElements:function(elem){try{elem=elem&&jabberwerx.$(elem.data).get(0);elem=this._authMech.evaluate(elem);if(elem){this._stream.send(elem);}else{var authComplete=this._authMech.complete;this._authMech=undefined;delete this._authMech;if(!authComplete){throw new jabberwerx.SASLMechanism.SASLAuthFailure();}else{this._setStreamHandler('streamOpened','_handleBindOpened');this._stream.reopen();}}}catch(ex){this._handleConnectionException(ex);}
return true;},_handleBindOpened:function(feats){try{this._clearStreamHandler('streamOpened');this._connectParams.bindJID=null;feats=jabberwerx.$(feats.data);this._connectParams.feats=feats;if(feats.find("bind[xmlns='urn:ietf:params:xml:ns:xmpp-bind']").length>0){var bindIQ=new jabberwerx.IQ();bindIQ.setType("set");bindIQ.setID(jabberwerx.Stanza.generateID());var builder=new jabberwerx.NodeBuilder('{urn:ietf:params:xml:ns:xmpp-bind}bind');if(this.resourceName){builder=builder.element("resource").text(this._connectParams.resource).parent;}
bindIQ.setQuery(builder.data);this._setStreamHandler("streamElementsReceived","_handleBindElements");this._stream.send(bindIQ.getNode());}else{this._handleConnected();}}catch(ex){this._handleConnectionException(ex);}},_handleBindElements:function(elements){try{var ele=jabberwerx.$(elements.data);var newjid=ele.find("bind>jid");if(newjid.length>0){this._connectParams.bindJID=jabberwerx.$(newjid).text();var jid=jabberwerx.JID.asJID(this._connectParams.bindJID);this.resourceName=jid.getResource();this._handleConnected();}else{this._handleConnectionException(ele.children("error").get(0));}}catch(ex){this._handleConnectionException(ex);}},_handleClosed:function(err){var msg='closed: '+(err&&err.data?jabberwerx.util.serializeXML(err.data):'no error');jabberwerx.util.debug.log(msg);if(this._connectParams.arg.register){this._connectParams.arg.register=false;jabberwerx.system.setTimeout(this.invocation("_openStream"),500);}else{this._disconnected(err.data);}},_handleConnectionException:function(ex){this._clearStreamHandlers();try{this._stream.close();}catch(e){};var n=this._exceptionToErrorNode(ex);jabberwerx.util.debug.log("Exception during connection: "+jabberwerx.util.serializeXML(n));this._disconnected(n);},_exceptionToErrorNode:function(ex){if(jabberwerx.isElement(ex)){return ex;}
var err=new jabberwerx.NodeBuilder("error");if(ex instanceof jabberwerx.SASLMechanism.SASLAuthFailure){err.element(ex.message);}else if(ex instanceof TypeError){err.element("{urn:ietf:params:xml:ns:xmpp-stanzas}bad-request");if(ex.message){err.element("text").text(ex.message);}}else{var errNode=jabberwerx.$(ex).find("conflict");if(errNode&&errNode.length!=0){var ns=jabberwerx.$(errNode).attr("xmlns");err.element("{"+ns+"}conflict");}else{var emsg=(ex&&ex.message)?ex.message:"{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error";try{err.element(emsg);}catch(e){err.element("{urn:ietf:params:xml:ns:xmpp-stanzas}internal-server-error");err.element("text").text(emsg);}}}
return err.data;},disconnect:function(){if(this.isConnected()){if(this._autoResourceName){this.resourceName=null;}
this.setClientStatus(jabberwerx.Client.status_disconnecting);this._stream.close();this._connectionAttempts=0;}},isConnected:function(){if(this._connectedRendezvous){return true;}
return(this.clientStatus==jabberwerx.Client.status_connected&&this._stream.isOpen());},setClientStatus:function(status,error,cb){var prev=this.clientStatus;this.clientStatus=status;if(prev&&(prev!=status)){var data={previous:prev,next:status,error:error};this.event('clientStatusChanged').trigger(data,null,cb);}else if(cb!=null){cb();}
jabberwerx.util.debug.log('client status: '+this.getClientStatusString(status),'clientStatus');},getClientStatusString:function(status){switch(status){case jabberwerx.Client.status_connected:return jabberwerx._("Connected to {0} as {1}.",(this.connectedServer?this.connectedServer.jid:jabberwerx._("(unknown)")),(this.connectedUser?this.connectedUser.jid:jabberwerx._("(unknown)")));case jabberwerx.Client.status_connecting:return jabberwerx._("Attempting to connect");case jabberwerx.Client.status_error:return jabberwerx._("Connection error");case jabberwerx.Client.status_disconnecting:return jabberwerx._("Disconnecting");case jabberwerx.Client.status_reconnecting:return jabberwerx._("Reconnecting");default:return jabberwerx._("Disconnected");}},getCurrentPresence:function(primary){var me=this.connectedUser;return(me&&(primary?me.getPrimaryPresence():me.getResourcePresence(this.resourceName)))||null;},sendStanza:function(rootName,type,to,content){var s;if(rootName instanceof jabberwerx.Stanza){s=rootName.clone();}else if(jabberwerx.isElement(rootName)){s=jabberwerx.Stanza.createWithNode(rootName);}else{s=new jabberwerx.Stanza(rootName);if(to){s.setTo(to.toString());}
if(type){s.setType(type.toString());}
if(content){if(typeof content=='string'){try{content=jabberwerx.util.unserializeXML(content);}catch(ex){jabberwerx.util.debug.log("sendStanza could not parse: '"+content+"'");throw ex;}}
new jabberwerx.NodeBuilder(s.getNode()).node(content);}
s=jabberwerx.Stanza.createWithNode(s.getNode());}
type=s.pType();this.event('before'+type+'Sent').trigger(s);this._stream.send(s.getNode());if(s instanceof jabberwerx.Presence){var presence=s;type=presence.getType();if((!type||(type=="unavailable"))&&!presence.getTo()){presence=presence.clone();presence.setFrom(this.fullJid.toString());this.connectedUser.updatePresence(presence);}}},sendMessage:function(to,body,subject,type,thread){this._assertConnected();var m=new jabberwerx.Message();if(to instanceof jabberwerx.Entity){to=to.jid;}else{to=jabberwerx.JID.asJID(to);}
m.setTo(to);m.setBody(body);if(subject){m.setSubject(subject);}
if(thread){m.setThread(thread);}
if(type){m.setType(type);}
if(type===undefined||type=='chat'){new jabberwerx.NodeBuilder(m.getNode()).element('{http://jabber.org/protocol/xhtml-im}html').element('{http://www.w3.org/1999/xhtml}body').text(body);}
this.sendStanza(m);},sendIQ:function(type,to,content,callback,timeout){return this.sendIq.apply(this,arguments);},sendIq:function(type,to,content,callback,timeout){if(callback!==undefined&&!jabberwerx.$.isFunction(callback)){throw new TypeError("callback must be a function");}
if(timeout!==undefined&&typeof(timeout)!="number"&&!(timeout instanceof Number)){throw new TypeError("timeout must be a number");}
var i=new jabberwerx.IQ();if(type){i.setType(type);}
if(to){i.setTo(to);}
var id=jabberwerx.Stanza.generateID();i.setID(id);if(content){if(typeof(content)=='string'){try{content=jabberwerx.util.unserializeXML(content);}catch(ex){jabberwerx.util.debug.log("sendIQ could not parse: '"+content+"'");throw ex;}}
new jabberwerx.NodeBuilder(i.getNode()).node(content);}
if(callback){var that=this;var tid=undefined;var fn=function(evt){var elem=evt.data;if(jabberwerx.isDocument(elem)){elem=elem.documentElement;}else if(elem instanceof jabberwerx.Stanza){elem=elem.getNode();}
elem=jabberwerx.$(elem);if(elem.attr("type")!="result"&&elem.attr("type")!="error"){return;}
if(elem.attr("id")!=id){return;}
var iqto=to;if(!iqto){iqto=(jabberwerx.JID.asJID(elem.attr("from")).getResource()==="")?that.fullJid.getBareJIDString():that.fullJid.toString();}
if(elem.attr("from")!=iqto){return;}
try{callback(elem.get()[0]);}catch(ex){jabberwerx.util.debug.log("sendIq callback threw exception: "+ex);}
evt.notifier.unbind(arguments.callee);if(tid){jabberwerx.system.clearTimeout(tid);tid=undefined;}
return true;};timeout=Number(timeout||0);if(timeout>0){var tfn=function(){if(tid){that.event('beforeIqReceived').unbind(fn);var iq=i.errorReply(jabberwerx.Stanza.ERR_REMOTE_SERVER_TIMEOUT);iq.setFrom(to);callback(iq.getNode());}}
tid=jabberwerx.system.setTimeout(tfn,timeout*1000);}
var idSel='[id="'+id+'"]';this.event('beforeIqReceived').bind(fn);}
this.sendStanza(i);return id;},sendPresence:function(show,status,to){var p=new jabberwerx.Presence();if(typeof show=='string'){p.setShow(show);}
if(typeof status=='string'){p.setStatus(status);}
if(to!==undefined){p.setTo(to);}
this.sendStanza(p);},selectNodes:function(stanzaDoc,selector){var filteredDoc=stanzaDoc;jabberwerx.util.debug.log('running jquery with selector: '+selector+" on doc:\n\n"+filteredDoc.xml,'stanzaSelectors');var result=jabberwerx.$(selector,filteredDoc);var nodes=[];result.each(function(){nodes.push(this);});if(nodes.length==1){return nodes[0];}
if(nodes.length==0){return null;}
return nodes;},getAllPresenceForEntity:function(jid){var retVal=[];jid=jabberwerx.JID.asJID(jid);var entity=this.entitySet.entity(jid.getBareJIDString());if(entity){if(!jid.getResource()){retVal=entity.getAllPresence();}else{retVal=[entity.getResourcePresence(jid.getResource())];}}
return retVal;},getPrimaryPresenceForEntity:function(jid){jid=jabberwerx.JID.asJID(jid);var entity=this.entitySet.entity(jid.getBareJIDString());if(entity){if(jid.getResource()){return entity.getResourcePresence(jid.getResource());}else{return entity.getPrimaryPresence();}}
return null;},_handlePresenceIn:function(eventObj){var entity;var presence=eventObj.data;var type=presence.getType();if(!type||type=='unavailable'){var bareJidStr=presence.getFromJID().getBareJIDString();if(bareJidStr){if(presence.getType()=='unavailable'){entity=this.entitySet.entity(bareJidStr);if(entity){entity.updatePresence(presence);}}else{entity=this._findOrCreateEntity(bareJidStr);entity.updatePresence(presence);}}}},_findOrCreateEntity:function(jid){var entity=this.entitySet.entity(jid);if(!entity){entity=this.entitySet.temporaryEntity(jid);}
return entity;},_cleanupEntityCache:function(){this.entitySet.startBatch();var that=this;this.entitySet.each(function(entity){if(entity.controller&&entity.controller.cleanupEntity)
{entity.controller.cleanupEntity(entity);}
else if((entity.controller===that.entitySet)||(entity instanceof jabberwerx.TemporaryEntity))
{entity.destroy();}});this.entitySet.endBatch();},willBeSerialized:function(){if(this._connectParams&&this._connectParams.password){if(jabberwerx._config.baseReconnectCountdown==0){this._connectParams.password="";}else{this._connectParams.password=jabberwerx.util.encodeSerialization(this._connectParams.password);}}
this._stopReceiveQueue(false);this._stanzaRecvQ=jabberwerx.$.map(this._stanzaRecvQ,function(){return this.xml;});},wasUnserialized:function(){if(this._connectParams&&this._connectParams.password){this._connectParams.password=jabberwerx.util.decodeSerialization(this._connectParams.password);}},graphUnserialized:function(){if(this._stanzaRecvQ.length){this._stanzaRecvQ=jabberwerx.$.map(this._stanzaRecvQ,function(){return jabberwerx.util.unserializeXML(this);});this._startReceiveQueue(true);}},_assertConnected:function(){if(!this.isConnected()){throw new jabberwerx.Client.NotConnectedError();}},_handleConnected:function(){if(jabberwerx._config.baseReconnectCountdown==0){this._connectParams.password="";}
this._clearStreamHandler("streamOpened");this._setStreamHandler("streamElementsReceived","_handleElementsReceived");this._setStreamHandler("streamElementsSent","_handleElementsSent");if(this._connectParams.bindJID){var jid=jabberwerx.JID.asJID(this._connectParams.bindJID);if(!jid.getBareJID().equals(this.connectedUser.jid)){this.entitySet._renameEntity(this.connectedUser,jid.getBareJID());if(this.connectedServer.jid.getDomain()!=jid.getDomain()){this.entitySet._renameEntity(this.connectedServer,jid.getDomain());}}
this.resourceName=jid.getResource();this._setFullJid();}
this._connectParams.bindJID=null;this.entitySet.startBatch();var rnz=new jabberwerx.Rendezvous(this.invocation("_completeConnected"));this._connectedRendezvous=rnz;var that=this;var delayed=jabberwerx.reduce(this.controllers,function(ctrl,value){return rnz.start(ctrl)||value;});if(!delayed){this._completeConnected();}},_connected:function(){this.event('clientConnected').trigger();},_disconnected:function(err){if(jabberwerx._config.baseReconnectCountdown==0){this._connectParams.password="";delete this._connectParams.password;}
if((this.clientStatus!=jabberwerx.Client.status_disconnecting)&&(this.clientStatus!=jabberwerx.Client.status_connecting)&&this._shouldReconnect(err))
{this._startReconnectCountdown();}
this._clearStreamHandlers();if(this.connectedUser){this.connectedUser.updatePresence();}
this.connectedUser=null;this._setFullJid();this.connectedServer=null;this._authMech=undefined;delete this._authMech;this._cleanupEntityCache();if(this._autoResourceName&&(this._countDownOn==0)){this.resourceName=null;}
delete this._connectedRendezvous;this._stopReceiveQueue(true);this.setClientStatus(jabberwerx.Client.status_disconnected,err);this.event('clientDisconnected').trigger(err);},_handleElementsReceived:function(evt){var elements=jabberwerx.$(evt.data).get();this._stanzaRecvQ=this._stanzaRecvQ.concat(elements);this._startReceiveQueue(false);},_handleElementsSent:function(evt){var elements=jabberwerx.$(evt.data);for(var i=0;i<elements.length;++i){this._handleElementOut(elements.get(i));}},cancelReconnect:function(){if(this._reconnectTimerID!==null){jabberwerx.system.clearTimeout(this._reconnectTimerID);this._reconnectTimerID=null;this._countDownOn=0;this.event('reconnectCancelled').trigger();}},isSecure:function(){return this._stream.isSecure();},_shouldReconnect:function(err){return jabberwerx.$("system-shutdown, conflict",err).length===0;},_startReconnectCountdown:function(){var base=Number(jabberwerx._config.baseReconnectCountdown);if(base>0){var reconnectCountdown=base+Math.round((Math.random()-0.5)*(base/5));this._reconnectTimerID=jabberwerx.system.setTimeout(this.invocation('_reconnectTimeoutHandler'),reconnectCountdown*1000);this._countDownOn=reconnectCountdown;this.event('reconnectCountdownStarted').trigger(reconnectCountdown);}},_reconnectTimeoutHandler:function(){this._countDownOn=0;this._reconnectTimerID=null;this._connectParams.arg.reconnecting=true;try{this.connect(this._connectParams.jid,this._connectParams.password,this._connectParams.arg);}catch(ex){jabberwerx.util.debug.log("Failed to reconnect: "+ex.message);}},_handleElementOut:function(stanza){stanza=jabberwerx.Stanza.createWithNode(stanza);var stanzaType=stanza.pType();this.event(stanzaType+"Sent").trigger(stanza);},_startReceiveQueue:function(){if(this._stanzaRecvWorker||!this._stanzaRecvQ.length){return;}
this._stanzaRecvWorker=jabberwerx.system.setTimeout(this.invocation("_processReceiveQueue"),jabberwerx.Client.STANZA_PROCESS_INTERVAL);},_stopReceiveQueue:function(clear){if(this._stanzaRecvWorker){jabberwerx.system.clearTimeout(this._stanzaRecvWorker);delete this._stanzaRecvWorker;}
if(clear){this._stanzaRecvQ=[];}},_processReceiveQueue:function(){var idx=0;delete this._stanzaRecvWorker;for(idx=0;idx<jabberwerx.Client.STANZA_PROCESS_COUNT;idx++){var processStanza=function(stanza,stanzaType,notifiers,that,handled){var handleStanza=function(results){handled=handled||Boolean(results);if(!handled){if(notifiers.length){notifiers.shift().trigger(stanza,undefined,handleStanza);}else{if(!results&&stanzaType=='iq'&&(stanza.getType()=='get'||stanza.getType()=='set')){stanza=stanza.errorReply(jabberwerx.Stanza.ERR_FEATURE_NOT_IMPLEMENTED);that.sendStanza(stanza);}}}};handleStanza(false);}
var stanza=this._stanzaRecvQ.shift();if(!stanza){return;}
stanza=jabberwerx.Stanza.createWithNode(stanza);var stanzaType=stanza.pType();var notifiers=[this.event('before'+stanzaType+'Received'),this.event(stanzaType+'Received'),this.event('after'+stanzaType+'Received')];var that=this;var handled=false;processStanza(stanza,stanzaType,notifiers,that,handled);}
this._startReceiveQueue(true);},_handleIqTime:function(evt){var now=new Date();var tz;tz=now.toString();tz=tz.substring(tz.lastIndexOf(' ')+1);var iq=evt.data;iq=iq.reply();var query=new jabberwerx.NodeBuilder(iq.getQuery());query.element('display').text(now.toLocaleString());query.element('utc').text(jabberwerx.generateTimestamp(now,true));query.element('tz').text(tz);this.sendStanza(iq);return true;},_handleEntityTime:function(evt){var now=new Date();var tzo;var h,m;tzo=now.getTimezoneOffset();h=tzo/60;m=tzo%60;tzo=(tzo>0?'-':'+')+
(h<10?'0'+h:h)+':'+
(m<10?'0'+m:m);var iq=evt.data;iq=iq.reply();var query=new jabberwerx.NodeBuilder(iq.getQuery());query.element('tzo').text(tzo);query.element('utc').text(jabberwerx.generateTimestamp(now,false));this.sendStanza(iq);return true;},_generateUsername:function(){return hex_md5(this._guid+((this._connectionAttempts)+(new Date().valueOf)));},_generatePassword:function(username){return hex_md5(username+Math.floor(Math.random()*3000)+2);},_completeConnected:function(rnz){delete this._connectedRendezvous;this.entitySet.endBatch();this.setClientStatus(jabberwerx.Client.status_connected,null,this.invocation("_connected"));},_setFullJid:function(){this.fullJid=this.connectedUser?jabberwerx.JID.asJID(this.connectedUser.jid+(this.resourceName?"/"+this.resourceName:"")):null;},controllers:{},resourceName:null,connectedUser:null,fullJid:null,_stream:null,_streamHandlers:[],clientStatus:3,connectedServer:null,entitySet:null,autoRegister:false,_stanzaRecvQ:[],_connectionAttempts:0,_reconnectTimerID:null,_connectParams:{},_autoResourceName:false,_countDownOn:0},'jabberwerx.Client');try{Object.defineProperty(jabberwerx.Client.prototype,"fullJid",{get:function(){return this.connectedUser?jabberwerx.JID.asJID(this.connectedUser.jid+(this.resourceName?"/"+this.resourceName:"")):null;},enumerable:true,writeable:false,configurable:false});jabberwerx.Client._setFullJid=function(){};}catch(ex){}
jabberwerx.Client.status_connecting=1;jabberwerx.Client.status_connected=2;jabberwerx.Client.status_disconnected=3;jabberwerx.Client.status_disconnecting=4;jabberwerx.Client.status_reconnecting=5;jabberwerx.Client.NotConnectedError=jabberwerx.util.Error.extend('The client is not connected.');jabberwerx.Client.ConnectionError=jabberwerx.util.Error.extend();jabberwerx.Client.DisconnectError=jabberwerx.util.Error.extend();jabberwerx.Client.STANZA_PROCESS_INTERVAL=1;jabberwerx.Client.STANZA_PROCESS_COUNT=5;})(jabberwerx);
/*build/dist/CAXL-release-2014.04.10787/src/controller/Controller.js*/
;(function(jabberwerx){jabberwerx.Controller=jabberwerx.JWModel.extend({init:function(client,name){this._super();if(!name||typeof name!='string'){throw new TypeError("name must be a non-empty string");}
if(!(client instanceof jabberwerx.Client)){throw new TypeError("client must be a jabberwerx.Client");}
this.client=client;this.name=name;var orig=client.controllers[name];if(orig){orig.destroy();}
client.controllers[name]=this;},destroy:function(){if(this.client&&this.client.controllers&&this.client.controllers[this.name]){delete this.client.controllers[this.name];delete this.client;}
this._super();},updateEntity:function(entity){if(!(entity&&entity instanceof jabberwerx.Entity&&entity.controller===this)){throw new TypeError("invalid entity to update");}
this.client.entitySet.event("entityUpdated").trigger(entity);return entity;},removeEntity:function(entity){if(!(entity&&entity instanceof jabberwerx.Entity&&entity.controller===this)){throw new TypeError("invalid entity to delete");}
entity.destroy();return entity;},cleanupEntity:function(entity){},client:null,name:''},'jabberwerx.Controller');})(jabberwerx);